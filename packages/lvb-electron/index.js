var _Reflect$construct=require("@babel/runtime-corejs3/core-js/reflect/construct"),_Object$getOwnPropertySymbols=require("@babel/runtime-corejs3/core-js/object/get-own-property-symbols"),_Object$getOwnPropertyDescriptor=require("@babel/runtime-corejs3/core-js/object/get-own-property-descriptor"),_Object$getOwnPropertyDescriptors=require("@babel/runtime-corejs3/core-js/object/get-own-property-descriptors"),_Object$defineProperties=require("@babel/runtime-corejs3/core-js/object/define-properties"),_Object$defineProperty=require("@babel/runtime-corejs3/core-js/object/define-property"),_toConsumableArray=require("@babel/runtime-corejs3/helpers/toConsumableArray"),_regeneratorRuntime=require("@babel/runtime-corejs3/regenerator"),_asyncToGenerator=require("@babel/runtime-corejs3/helpers/asyncToGenerator"),_defineProperty=require("@babel/runtime-corejs3/helpers/defineProperty"),_get=require("@babel/runtime-corejs3/helpers/get"),_inherits=require("@babel/runtime-corejs3/helpers/inherits"),_possibleConstructorReturn=require("@babel/runtime-corejs3/helpers/possibleConstructorReturn"),_getPrototypeOf=require("@babel/runtime-corejs3/helpers/getPrototypeOf"),_classCallCheck=require("@babel/runtime-corejs3/helpers/classCallCheck"),_createClass=require("@babel/runtime-corejs3/helpers/createClass"),_globalThis=require("@babel/runtime-corejs3/core-js/global-this"),_setTimeout=require("@babel/runtime-corejs3/core-js/set-timeout"),_forEachInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/for-each"),_JSON$stringify=require("@babel/runtime-corejs3/core-js/json/stringify"),_concatInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/concat"),_Array$isArray=require("@babel/runtime-corejs3/core-js/array/is-array"),_filterInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/filter"),_Object$keys=require("@babel/runtime-corejs3/core-js/object/keys"),_Promise=require("@babel/runtime-corejs3/core-js/promise"),_Object$create=require("@babel/runtime-corejs3/core-js/object/create"),_parseInt=require("@babel/runtime-corejs3/core-js/parse-int"),_sliceInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/slice"),_Map=require("@babel/runtime-corejs3/core-js/map"),_mapInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/map"),_setInterval=require("@babel/runtime-corejs3/core-js/set-interval"),_Array$from=require("@babel/runtime-corejs3/core-js/array/from"),_findIndexInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/find-index"),_spliceInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/splice"),_includesInstanceProperty=require("@babel/runtime-corejs3/core-js/instance/includes"),_typeof=require("@babel/runtime-corejs3/helpers/typeof");function ownKeys(e,t){var r=_Object$keys(e);if(_Object$getOwnPropertySymbols){var n=_Object$getOwnPropertySymbols(e);t&&(n=_filterInstanceProperty(n).call(n,(function(t){return _Object$getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r,n=null!=arguments[t]?arguments[t]:{};if(t%2)_forEachInstanceProperty(r=ownKeys(Object(n),!0)).call(r,(function(t){_defineProperty(e,t,n[t])}));else if(_Object$getOwnPropertyDescriptors)_Object$defineProperties(e,_Object$getOwnPropertyDescriptors(n));else{var o;_forEachInstanceProperty(o=ownKeys(Object(n))).call(o,(function(t){_Object$defineProperty(e,t,_Object$getOwnPropertyDescriptor(n,t))}))}}return e}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var r,n=_getPrototypeOf(e);if(t){var o=_getPrototypeOf(this).constructor;r=_Reflect$construct(n,arguments,o)}else r=n.apply(this,arguments);return _possibleConstructorReturn(this,r)}}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!_Reflect$construct)return!1;if(_Reflect$construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(_Reflect$construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}!function(e,t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t(require("wolfy87-eventemitter"),require("agora-electron-sdk"),require("axios"),require("protobufjs/minimal")):"function"==typeof define&&define.amd?define(["wolfy87-eventemitter","agora-electron-sdk","axios","protobufjs/minimal"],t):(e=void 0!==_globalThis?_globalThis:e||self).LvbElectronSdk=t(e.EventEmitter,e.AgoraRtcEngine,e.axios,e.minimal)}(this,(function(e,t,r,n){"use strict";function o(e){return e&&"object"==_typeof(e)&&"default"in e?e:{default:e}}var i=o(e),s=o(t),a=o(r),c=o(n),u="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};u.clearTimeout;var l=u.performance||{};l.now||l.mozNow||l.msNow||l.oNow||l.webkitNow;var d={High:"high",Medium:"medium",Low:"low",Low_288x162:"low-288x162"};function _(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Math.round(e/t*100)}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:255;return Math.round(e/100*t)}var f=function(){function e(){_classCallCheck(this,e),this.cacheCanvasOpts={},this.yuv={},this.event=new i.default,this.ready=!1,this.contentMode=0,this.container={},this.canvas={},this.element={}}return _createClass(e,[{key:"bind",value:function(e){throw new Error("You have to declare your own custom render")}},{key:"unbind",value:function(){throw new Error("You have to declare your own custom render")}},{key:"equalsElement",value:function(e){throw new Error("You have to declare your own custom render")}},{key:"drawFrame",value:function(e){throw new Error("You have to declare your own custom render")}},{key:"setContentMode",value:function(e){throw new Error("You have to declare your own custom render")}},{key:"refreshCanvas",value:function(){throw new Error("You have to declare your own custom render")}}]),e}(),y={0:"none",1:"good",2:"good",3:"normal",4:"normal",5:"poor",6:"poor"},g={0:"disconnected",1:"ethernet",2:"wifi",3:"cellular-2G",4:"cellular-3G",5:"cellular-4G","-1":"unknown"},m=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this))._appId=null,e._rtcToken=null,e._roomId=null,e._rtc=null,e._host=!0,e._screenShareUid=null,e._screenShareToken=null,e._localVideoEnable=!1,e._localAudioEnable=!1,e._localVideoStreamEnable=!1,e._localAudioStreamEnable=!1,e._previewed=!1,e._localVideoPublished=0,e._localAudioPublished=0,e._LocalStreamPublished=0,e.offlineTimer=null,e._networkQuality=null,e._clientState=null,e._localVideoState=null,e._localAudioState=null,e._remoteVideoState=null,e._remoteAudioState=null,e._appState=null,e._autoSubscribe=!1,e}return _createClass(r,[{key:"rtcState",get:function(){return this._LocalStreamPublished}},{key:"networkQuality",get:function(){return this._networkQuality}},{key:"clientState",get:function(){return this._clientState}},{key:"localVideoState",get:function(){return this._localVideoState}},{key:"localAudioState",get:function(){return this._localAudioState}},{key:"remoteVideoState",get:function(){return this._remoteVideoState}},{key:"appState",get:function(){return this._appState}},{key:"remoteAudioState",get:function(){return this._remoteAudioState}},{key:"_setDefaultParams",value:function(){this._rtc.setParameters('{"che.audio.live_for_comm": true}'),this._rtc.setParameters('{"che.video.moreFecSchemeEnabled": true}')}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_get(_getPrototypeOf(r.prototype),"init",this).call(this,e),!e.hasOwnProperty("appId"))throw Error("miss app id");this._appId=e.appId,console.debug("RTC::init",this._appId),e.hasOwnProperty("userId")&&(this._uid=e.userId),e.hasOwnProperty("roomId")&&(this._roomId=e.roomId.toString()),e.hasOwnProperty("token")&&(this._rtcToken=e.token),e.hasOwnProperty("screenShare")&&(this._screenShareUid=e.screenShare.id,this._screenShareToken=e.screenShare.token),this._rtcProfile=e.hasOwnProperty("rtcProfile")?e.rtcProfile:r.RtcProfile.VideoCall,this._host=!e.hasOwnProperty("isHost")||e.host,this._autoSubscribe=!(!e.hasOwnProperty("autoSubscribe")||"boolean"!=typeof e.autoSubscribe)&&e.autoSubscribe,this._rtc=new s.default,this._rtc.setChannelProfile(this._rtcProfile);var t=this._host?1:2;this._rtc.setClientRole(t),this.bindEvents(),this._rtc.initialize(this._appId);var n=e.hasOwnProperty("videoQuality")?e.videoQuality:d.Low;this.setVideoQuality(n),this._rtc.enableAudioVolumeIndication(200,3,!0);var o=e.hasOwnProperty("rendererMode")?e.rendererMode:1;this._rtc.setRenderMode(o),3===o&&this._rtc.setCustomRenderer(f),this._setDefaultParams()}},{key:"createTestRTC",value:function(e){e=e||this._appId;var t=new s.default,n=new i.default;return t.on("lastMileQuality",(function(e){console.debug("lastMileQuality: quality: ".concat(e)),n.trigger(I.NETWORK_QUALITY,[r.convertNetworkQuality(e)])})),t.on("lastmileProbeResult",(function(e){console.debug("lastmileProbeResult: result: ".concat(e)),n.trigger(I.NETWORK_RESULT,[e])})),t.on("videoDeviceStateChanged",(function(e,t,r){n.trigger(I.VIDEO_DEVICE_CHANGE,[e,t,r])})),t.on("audioDeviceStateChanged",(function(e,t,r){n.trigger(I.AUDIO_DEVICE_CHANGE,[e,t,r])})),t.on("groupAudioVolumeIndication",(function(e,t,r){_forEachInstanceProperty(e).call(e,(function(e){var t=h(e.volume);n.trigger(I.AUDIO_LEVEL_CHANGE,[e.uid,t])}))})),t.initialize(e),{getCameraDevices:function(){return t.getVideoDevices()},getActiveCameraDevice:function(){return t.getCurrentVideoDevice()},setActiveCameraDevice:function(e){t.setVideoDevice(e)},getSpeakerDevices:function(){return t.getAudioPlaybackDevices()},getActiveSpeakerDevice:function(){return t.getCurrentAudioPlaybackDevice()},setActiveSpeakerDevice:function(e){t.setAudioPlaybackDevice(e)},getMicrophoneDevices:function(){return t.getAudioRecordingDevices()},getActiveMicrophoneDevice:function(){return t.getCurrentAudioRecordingDevice()},setActiveMicrophoneDevice:function(e){t.setAudioRecordingDevice(e)},startLastmileProbeTest:function(){t.startLastmileProbeTest({expectedDownlinkBitrate:5e6,expectedUplinkBitrate:5e6,probeDownlink:!0,probeUplink:!0})},stopLastmileProbeTest:function(){t.stopLastmileProbeTest()},enableLastmileTest:function(){t.enableLastmileTest()},disableLastmileTest:function(){t.disableLastmileTest()},startCameraTest:function(e){var r=document.querySelector("#".concat(e));0===t.enableLocalVideo(!0)&&(t.setupLocalVideo(r),t.startPreview())},stopCameraTest:function(){t.stopPreview()},getSpeakerVolume:function(){return h(t.getAudioPlaybackVolume())},setSpeakerVolume:function(e){e=p(e),t.setAudioPlaybackVolume(e)},getMicVolume:function(){return h(t.getAudioRecordingVolume())},setMicVolume:function(e){e=p(e),t.setAudioRecordingVolume(e)},startSpeakerTest:function(e){t.startAudioPlaybackDeviceTest(e)},stopSpeakerTest:function(){t.stopAudioPlaybackDeviceTest()},startMicTest:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;t.startAudioRecordingDeviceTest(e)},stopMicTest:function(){t.stopAudioRecordingDeviceTest()},startAudioDeviceLoopbackTest:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200;t.startAudioDeviceLoopbackTest(e)},stopAudioDeviceLoopbackTest:function(){t.stopAudioDeviceLoopbackTest()},enableVirtualBackground:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.VituralBackgroundType.Color,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={background_source_type:n};return o.hasOwnProperty("color")?i.color=o.color:i.color=16777215,o.hasOwnProperty("source")&&(i.source=o.source),t.enableVirtualBackground(e,i)},release:function(){t&&t.release(),t=null},on:function(e,t){n.on(e,t)}}}},{key:"setVideoQuality",value:function(e){if(this._rtc){var t=null;switch(e){case d.High:t={bitrate:0,minBitrate:-1,degradationPreference:0,frameRate:15,minFrameRate:-1,width:640,height:360,mirrorMode:0,orientationMode:0};break;case d.Medium:t={bitrate:50,minBitrate:-1,degradationPreference:0,frameRate:5,minFrameRate:-1,width:640,height:360,mirrorMode:0,orientationMode:0};break;case d.Low:t={bitrate:50,minBitrate:-1,degradationPreference:0,frameRate:5,minFrameRate:-1,width:320,height:180,mirrorMode:0,orientationMode:0};break;case d.Low_288x162:t={bitrate:40,minBitrate:-1,degradationPreference:0,frameRate:5,minFrameRate:-1,width:288,height:162,mirrorMode:0,orientationMode:0}}t&&this._rtc.setVideoEncoderConfiguration(t)}}},{key:"getNetworkQuality",value:function(e){return y.hasOwnProperty(e.toString())?y[e.toString()]:"none"}},{key:"bindEvents",value:function(){var e=this;this._rtc&&(this._rtc.on("apiCallExecuted",(function(e,t){console.debug("ApiCall: ",_JSON$stringify({api:e,err:t}))})),this._rtc.on("warning",(function(e,t){console.debug("warning: ",_JSON$stringify({warn:e,msg:t}))})),this._rtc.on("error",(function(t,r){console.error("error: ",_JSON$stringify({err:t,msg:r})),e._bus.trigger(R.ERROR,[{err:t,msg:r}])})),this._rtc.on("joinedChannel",(function(t,r,n){var o,i;console.debug(_concatInstanceProperty(o=_concatInstanceProperty(i="joinedChannel channel: ".concat(t," uid: ")).call(i,r," elapsed: ")).call(o,n)),e._bus.trigger(R.LOCAL_JOIN,[t,r])})),this._rtc.on("rejoinedChannel",(function(e,t,r){var n,o;console.debug(_concatInstanceProperty(n=_concatInstanceProperty(o="rejoinedChannel channel: ".concat(e," uid: ")).call(o,t," elapsed: ")).call(n,r))})),this._rtc.on("userJoined",(function(t){console.debug("userJoined uid: ".concat(t)),e._autoSubscribe&&e.subscribe(t),e._rtc.setupViewContentMode(t,1),e._bus.trigger(R.REMOTE_USER_JOIN,[t])})),this._rtc.on("removeStream",(function(t,r){var n;console.debug(_concatInstanceProperty(n="removeStream uid: ".concat(t," reason: ")).call(n,r)),e._bus.trigger(R.REMOTE_USER_LEAVE,[t])})),this._rtc.on("userOffline",(function(t,r){var n;console.debug(_concatInstanceProperty(n="userOffline uid: ".concat(t," reason: ")).call(n,r)),e._remoteVideoState&&e._remoteVideoState.hasOwnProperty(t.toString())&&delete e._remoteVideoState[t.toString()],e._remoteAudioState&&e._remoteAudioState.hasOwnProperty(t.toString())&&delete e._remoteAudioState[t.toString()],e._bus.trigger(R.REMOTE_USER_LEAVE,[t])})),this._rtc.on("groupAudioVolumeIndication",(function(t,r,n){_forEachInstanceProperty(t).call(t,(function(t){var r=h(t.volume);e._bus.trigger(R.AUDIO_LEVEL_CHANGE,[t.uid,r])}))})),this._rtc.on("leaveChannel",(function(){console.debug("leaveChannel uid: ".concat(e._uid)),e._bus.trigger(R.LOCAL_LEAVE,[e._uid])})),this._rtc.on("rtcStats",(function(t){var r={rtt:t.gatewayRtt,duration:t.duration,recvBitrate:t.rxKBitRate,recvBytes:t.rxBytes,sendBitrate:t.txKBitRate,sendBytes:t.txBytes,userCount:t.userCount,lastmileDelay:t.lastmileDelay};e._clientState?e._clientState=_objectSpread(_objectSpread({},e._clientState),r):e._clientState=r,e._appState={cpuAppUsage:t.cpuAppUsage,cpuTotalUsage:t.cpuTotalUsage,memoryAppUsageRatio:t.memoryAppUsageRatio,memoryTotalUsageRatio:t.memoryTotalUsageRatio}})),this._rtc.on("localVideoStats",(function(t){e._localVideoState=[{uid:e._uid,sentBitrate:t.sentBitrate,sentFrameRate:t.sentFrameRate,targetBitrate:t.targetBitrate,targetFrameRate:t.targetFrameRate,width:t.encodedFrameWidth,height:t.encodedFrameHeight,codecType:0===t.codecType?"VP8":"H264"}]})),this._rtc.on("localAudioStats",(function(t){e._localAudioState=[{uid:e._uid,sampleRate:t.sentSampleRate,sentBitrate:t.sentBitrate,numChannels:t.numChannels}]})),this._rtc.on("remoteVideoStats",(function(t){e._remoteVideoState||(e._remoteVideoState={}),e._remoteVideoState[t.uid.toString()]=t})),this._rtc.on("remoteAudioStats",(function(t){e._remoteAudioState||(e._remoteAudioState={}),e._remoteAudioState[t.uid.toString()]=_objectSpread(_objectSpread({},t),{},{packetLossRate:t.audioLossRate})})),this._rtc.on("audioDeviceStateChanged",(function(t,r,n){var o,i;console.debug(_concatInstanceProperty(o=_concatInstanceProperty(i="audioDeviceStateChanged: deviceId: ".concat(t," deviceType: ")).call(i,t," deviceState: ")).call(o,n)),e._bus.trigger(R.AUDIO_DEVICE_STATE_CHANGE,[t,r,n])})),this._rtc.on("videoDeviceStateChanged",(function(t,r,n){var o,i;console.debug(_concatInstanceProperty(o=_concatInstanceProperty(i="videoDeviceStateChanged: (deviceI: deviceId: ".concat(t," deviceType: ")).call(i,t," deviceState: ")).call(o,n)),e._bus.trigger(R.VIDEO_DEVICE_STATE_CHANGE,[t,r,n])})),this._rtc.on("audioMixingStateChanged",(function(t,r){var n;console.debug(_concatInstanceProperty(n="audioMixingStateChanged: state: ".concat(_JSON$stringify(t)," err: ")).call(n,r));var o="stop";switch(t){case 710:o="play";break;case 711:o="pause";break;case 713:o="stop";break;case 714:o="error"}e._bus.trigger(R.AUDIO_MIXING_STATE,[o])})),this._rtc.on("remoteAudioMixingBegin",(function(){console.debug("remoteAudioMixingBegin")})),this._rtc.on("remoteAudioMixingEnd",(function(){console.debug("remoteAudioMixingEnd")})),this._rtc.on("audioEffectFinished",(function(e){console.debug("audioEffectFinished: ".concat(e))})),this._rtc.on("networkQuality",(function(t,r,n){var o=e.getNetworkQuality(r),i=e.getNetworkQuality(n);0===t?(e._networkQuality={upLinkQuality:o,downLinkQuality:i},e._bus.trigger(R.LOCAL_NETWORK_QUALITY,[o,i])):e._bus.trigger(R.REMOTE_NETWORK_QUALITY,[t,o,i])})),this._rtc.on("lastMileQuality",(function(e){console.debug("lastMileQuality: quality: ".concat(e))})),this._rtc.on("lastmileProbeResult",(function(e){console.debug("lastmileProbeResult: result: ".concat(e))})),this._rtc.on("firstLocalVideoFrame",(function(e,t,r){var n,o;console.debug(_concatInstanceProperty(n=_concatInstanceProperty(o="firstLocalVideoFrame: width:".concat(e," height: ")).call(o,t," elapsed: ")).call(n,r))})),this._rtc.on("videoSizeChanged",(function(t,r,n,o){var i,s,a;t=0===t?e._uid:t,console.debug(_concatInstanceProperty(i=_concatInstanceProperty(s=_concatInstanceProperty(a="videoSizeChanged: uid: ".concat(t," width:")).call(a,r," height: ")).call(s,n," rotation: ")).call(i,o)),e._bus.trigger(R.VIDEO_SIZE_CHANGE,[t,r,n,o])})),this._rtc.on("userMuteVideo",(function(e,t){var r;console.debug(_concatInstanceProperty(r="userMuteVideo: uid: ".concat(e," muted: ")).call(r,t))})),this._rtc.on("connectionLost",(function(){console.debug("connectionLost"),e._bus.emitEvent(R.CONNECTION_LOST)})),this._rtc.on("streamMessage",(function(e,t,r,n){var o,i,s;console.debug(_concatInstanceProperty(o=_concatInstanceProperty(i=_concatInstanceProperty(s="streamMessage: uid:".concat(e," streamId: ")).call(s,t," msg: ")).call(i,r," len: ")).call(o,n))})),this._rtc.on("streamMessageError",(function(e,t,r,n,o){var i,s,a,c;console.debug(_concatInstanceProperty(i=_concatInstanceProperty(s=_concatInstanceProperty(a=_concatInstanceProperty(c="streamMessageError: uid:".concat(e," streamId: ")).call(c,t," code: ")).call(a,r," missed: ")).call(s,n," cached: ")).call(i,o))})),this._rtc.on("mediaEngineStartCallSuccess",(function(){console.debug("mediaEngineStartCallSuccess")})),this._rtc.on("requestChannelKey",(function(){console.debug("requestChannelKey")})),this._rtc.on("firstLocalAudioFrame",(function(e){console.debug("firstLocalAudioFrame: elapsed: ".concat(e))})),this._rtc.on("activeSpeaker",(function(t){console.debug("activeSpeaker: uid: ".concat(t)),e._bus.trigger(R.ACTIVE_USER,[t])})),this._rtc.on("clientRoleChanged",(function(e,t){var r;console.debug(_concatInstanceProperty(r="clientRoleChanged: oldRole: ".concat(e," newRole: ")).call(r,t))})),this._rtc.on("audioDeviceVolumeChanged",(function(e,t,r){var n,o;console.debug(_concatInstanceProperty(n=_concatInstanceProperty(o="audioDeviceVolumeChanged: deviceType: ".concat(e," volume: ")).call(o,t," muted: ")).call(n,r))})),this._rtc.on("videoSourceJoinedSuccess",(function(t){console.debug("videoSourceJoinedSuccess: uid: ".concat(t)),e._bus.trigger(R.SCREEN_SHARE_JOIN,[t])})),this._rtc.on("videoSourceRequestNewToken",(function(){console.debug("videoSourceRequestNewToken")})),this._rtc.on("videoSourceLeaveChannel",(function(){console.debug("videoSourceLeaveChannel"),e._bus.trigger(R.SCREEN_SHARE_LEAVE,[e._screenShareUid])})),this._rtc.on("remoteVideoStateChanged",(function(t,r,n,o){var i,s,a;switch(console.debug(_concatInstanceProperty(i=_concatInstanceProperty(s=_concatInstanceProperty(a="remoteVideoStateChanged: uid: ".concat(t," state: ")).call(a,r," reason: ")).call(s,n," elapsed: ")).call(i,o)),1===r&&e._bus.trigger(R.REMOTE_VIDEO_FIRST_FRAME,[t]),n){case 3:case 4:break;case 5:e._bus.trigger(R.REMOTE_VIDEO_OFF,[t]);break;case 6:e._bus.trigger(R.REMOTE_VIDEO_ON,[t])}})),this._rtc.on("remoteAudioStateChanged",(function(t,r,n,o){var i,s,a;switch(console.debug(_concatInstanceProperty(i=_concatInstanceProperty(s=_concatInstanceProperty(a="remoteAudioStateChanged: uid: ".concat(t," state: ")).call(a,r," reason: ")).call(s,n," elapsed: ")).call(i,o)),n){case 3:case 4:break;case 5:e._bus.trigger(R.REMOTE_AUDIO_OFF,[t]);break;case 6:e._bus.trigger(R.REMOTE_AUDIO_ON,[t])}})),this._rtc.on("cameraFocusAreaChanged",(function(e,t,r,n){var o,i,s;console.debug(_concatInstanceProperty(o=_concatInstanceProperty(i=_concatInstanceProperty(s="cameraFocusAreaChanged: x: ".concat(e," y: ")).call(s,t," width: ")).call(i,r," height: ")).call(o,n))})),this._rtc.on("cameraExposureAreaChanged",(function(e,t,r,n){var o,i,s;console.debug(_concatInstanceProperty(o=_concatInstanceProperty(i=_concatInstanceProperty(s="cameraExposureAreaChanged: x: ".concat(e," y: ")).call(s,t," width: ")).call(i,r," height: ")).call(o,n))})),this._rtc.on("tokenPrivilegeWillExpire",(function(e){console.debug("tokenPrivilegeWillExpire: token: ".concat(e))})),this._rtc.on("streamUnpublished",(function(e){console.debug("streamUnpublished: token: ".concat(e))})),this._rtc.on("rtmpStreamingStateChanged",(function(e,t,r){var n,o;console.debug(_concatInstanceProperty(n=_concatInstanceProperty(o="rtmpStreamingStateChanged: url: ".concat(e," state: ")).call(o,t," code: ")).call(n,r))})),this._rtc.on("transcodingUpdated",(function(){console.debug("transcodingUpdated")})),this._rtc.on("streamInjectStatus",(function(e,t,r){var n,o;console.debug(_concatInstanceProperty(n=_concatInstanceProperty(o="streamInjectStatus: url: ".concat(e," uid: ")).call(o,t," status: ")).call(n,r))})),this._rtc.on("localPublishFallbackToAudioOnly",(function(e){console.debug("localPublishFallbackToAudioOnly: isFallbackOrRecover: ".concat(e))})),this._rtc.on("remoteSubscribeFallbackToAudioOnly",(function(e,t){var r;console.debug(_concatInstanceProperty(r="remoteSubscribeFallbackToAudioOnly: uid: ".concat(e," isFallbackOrRecover: ")).call(r,t))})),this._rtc.on("connectionStateChanged",(function(t,r){var n;console.debug(_concatInstanceProperty(n="connectionStateChanged: state: ".concat(t," reason: ")).call(n,r)),10===r&&e._bus.emitEvent(R.LOCAL_USER_BANNED)})),this._rtc.on("localUserRegistered",(function(e,t){var r;console.debug(_concatInstanceProperty(r="localUserRegistered: uid: ".concat(e," userAccount: ")).call(r,t))})),this._rtc.on("userInfoUpdated",(function(e,t){var r;console.debug(_concatInstanceProperty(r="userInfoUpdated: uid: ".concat(e," userInfo: ")).call(r,t))})),this._rtc.on("localVideoStateChanged",(function(e,t){var r;console.debug(_concatInstanceProperty(r="localVideoStateChanged: state: ".concat(e," err: ")).call(r,t))})),this._rtc.on("localAudioStateChanged",(function(e,t){var r;console.debug(_concatInstanceProperty(r="localAudioStateChanged: state: ".concat(e," err: ")).call(r,t))})),this._rtc.on("channelMediaRelayState",(function(e,t){var r;console.debug(_concatInstanceProperty(r="channelMediaRelayState: state: ".concat(e," code: ")).call(r,t))})),this._rtc.on("channelMediaRelayEvent",(function(e){console.debug("channelMediaRelayEvent: event: ".concat(e))})),this._rtc.on("videoPublishStateChanged",(function(t,r,n,o){console.debug("videoPublishStateChanged: ",t,r,n,o),1===n?(e._localVideoPublished=0,e.setupOfflineTimer(),e._bus.trigger(R.LOCAL_USER_VIDEO_UNPUBLISHED,[e._uid])):3===n&&(e._localVideoPublished=1,e.setupOfflineTimer(),e._bus.trigger(R.LOCAL_USER_VIDEO_PUBLISHED,[e._uid]))})),this._rtc.on("audioPublishStateChanged",(function(t,r,n,o){console.log("AudioPublish: ",t,r,n,o),1===n?(e._localAudioPublished=0,e.setupOfflineTimer(),e._bus.trigger(R.LOCAL_USER_AUDIO_UNPUBLISHED,[e._uid])):3===n&&(e._localAudioPublished=1,e.setupOfflineTimer(),e._bus.trigger(R.LOCAL_USER_AUDIO_PUBLISHED,[e._uid]))})),this._rtc.on("networkTypeChanged",(function(t){e._clientState?e._clientState.networkType=g[t.toString()]:e._clientState={networkType:g[t.toString()]}})),this._rtc.on("videoSourceLocalVideoStats",(function(e){console.debug("videoSourceLocalVideoStats:",e)})),this._rtc.on("videoSourceLocalVideoStateChanged",(function(e,t){console.debug("videoSourceLocalVideoStateChanged",e,t)})),this._rtc.on("virtualBackgroundSourceEnabled",(function(e,t){console.debug("virtualBackgroundSourceEnabled",e,t)})))}},{key:"setupOfflineTimer",value:function(){var e=this,t=this._localAudioPublished|this._localVideoPublished;t?(this.offlineTimer&&(clearTimeout(this.offlineTimer),this.offlineTimer=null),this._localAudioPublished!==t&&(this._LocalStreamPublished=t,this.trigger(R.LOCAL_USER_ONLINE,[this._uid]))):this.offlineTimer||(this.offlineTimer=_setTimeout((function(){clearTimeout(e.offlineTimer),e.offlineTimer=null,e._LocalStreamPublished=0,e.trigger(R.LOCAL_USER_OFFLINE,[e._uid])}),3e3))}},{key:"on",value:function(e,t){this._bus&&this._bus.on(e,t)}},{key:"emitEvent",value:function(e,t){this._bus&&(t?_Array$isArray(t)&&this._bus.emitEvent(e,t):this._bus.emitEvent(e))}},{key:"emit",value:function(e){this._bus&&this.emitEvent(e)}},{key:"trigger",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._bus&&this._bus.trigger(e,t)}},{key:"join",value:function(){var e=this._rtc.joinChannel(this._rtcToken,this._roomId,"",this._uid);if(0!==e)throw console.error("join room failed: ".concat(e)),Error("join room failed");this._rtc.enableLocalVideo(!1),this._rtc.enableLocalAudio(!1),this._rtc.muteLocalAudioStream(!0),this._rtc.muteLocalVideoStream(!0),this._rtc.muteAllRemoteVideoStreams(!0),this._rtc.muteAllRemoteAudioStreams(!0),this._joined=!0}},{key:"leave",value:function(){this._rtc&&(this.enableVideo(!1),this.enableAudio(!1),this._previewed&&this.stopPreview(),this._rtc.leaveChannel(),this._rtc.release(),this._localVideoEnable=!1)}},{key:"destroy",value:function(){this.leave(),this._localVideoEnable=!1,this._localAudioEnable=!1,this._localVideoStreamEnable=!1,this._localAudioStreamEnable=!1}},{key:"enableLocalVideo",value:function(e){if(!this._rtc)return 1;var t=0;return this._localVideoEnable!==e&&(0===(t=this._rtc.enableLocalVideo(e))&&(this._localVideoEnable=e)),t}},{key:"enableLocalAudio",value:function(e){if(!this._rtc)return 1;var t=0;return this._localAudioEnable!==e&&(0===(t=this._rtc.enableLocalAudio(e))&&(this._localAudioEnable=e)),t}},{key:"enableLocalMediaCapture",value:function(e){if(!this._rtc)return 1;var t=this.enableLocalVideo(e);return 0===t&&(t=this.enableLocalAudio(e)),t}},{key:"enableLocalMediaCapture2",value:function(e,t){if(!this._rtc)return 1;var r=this.enableLocalVideo(e);return 0===r&&(r=this.enableLocalAudio(t)),r}},{key:"enableLocalVideoStream",value:function(e){if(!this._rtc)return 1;var t=0;return this._localVideoStreamEnable!==e&&(0===(t=this._rtc.muteLocalVideoStream(!e))&&(this._localVideoStreamEnable=e)),t}},{key:"enableVideo",value:function(e){var t=this.enableLocalVideo(e);return 0===t&&(t=this.enableLocalVideoStream(e)),t}},{key:"enableLocalAudioStream",value:function(e){if(!this._rtc)return 1;var t=0;return this._localAudioStreamEnable!==e&&(0===(t=this._rtc.muteLocalAudioStream(!e))&&(this._localAudioStreamEnable=e)),t}},{key:"enableAudio",value:function(e){var t=this.enableLocalAudio(e);return 0===t&&(t=this.enableLocalAudioStream(e)),t}},{key:"enableLocalStream",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.enableLocalVideoStream(e);return 0===r&&t&&(r=this.enableLocalAudioStream(e)),r}},{key:"enableLocalStream2",value:function(e,t){var r=this.enableLocalVideoStream(e);return 0===r&&(r=this.enableLocalAudioStream(t)),r}},{key:"publish",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._rtc){var t=this.enableLocalMediaCapture(!0);0===t&&(t=this.enableLocalStream(!0,e),this._published=0===t)}}},{key:"publish2",value:function(e,t){var r;if(this._rtc){console.debug(_concatInstanceProperty(r="lvb-electron:RTC:publish2: video-".concat(e," audio-")).call(r,t));var n=this.enableLocalMediaCapture2(e,t);0===n&&(n=this.enableLocalStream2(e,t),this._published=0===n)}}},{key:"unpublish",value:function(){if(this._rtc){var e=this.enableLocalStream(!1);0===e&&(e=this.enableLocalStream(!1),this._published=0===e)}}},{key:"stopLocalPlay",value:function(){this.enableLocalVideo(!1),this.enableLocalAudio(!1)}},{key:"play",value:function(e,t){var r,n=document.querySelector("#".concat(e));return t&&t!==this._uid?(this._rtc.setupViewContentMode(t,1),r=this._rtc.subscribe(t,n)):r=this._rtc.setupLocalVideo(n),r}},{key:"setupLocalVideo",value:function(e){if(this._rtc)return this._rtc.setupLocalVideo(e)}},{key:"subscribe",value:function(e){if(this._rtc){var t=e.toString();this._remoteStreams.hasOwnProperty(t)&&this._remoteStreams[t]||(this._remoteStreams[t]=!0,this._rtc.muteRemoteVideoStream(e,!1),this._rtc.muteRemoteAudioStream(e,!1),this._bus.trigger(R.REMOTE_STREAM_SUBSCRIBED,[e]))}}},{key:"unsubscribe",value:function(e){if(this._rtc){var t=e.toString();this._remoteStreams.hasOwnProperty(t)&&this._remoteStreams[t]&&(this._remoteStreams[t]=!1,this._rtc.muteRemoteVideoStream(e,!0),this._rtc.muteRemoteAudioStream(e,!0),this._bus.trigger(R.REMOTE_STREAM_UNSUBSCRIBED,[e]))}}},{key:"unsubscribeAll",value:function(){if(this._rtc)for(var e in this._remoteStreams)this._remoteStreams[e]&&(this._remoteStreams[e]=!1,this._rtc.muteRemoteVideoStream(Number(e),!0),this._rtc.muteRemoteAudioStream(Number(e),!0),this._bus.trigger(R.REMOTE_STREAM_UNSUBSCRIBED,[e]))}},{key:"startPreview",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._rtc&&(e&&this.play(e),this._previewed||(this._rtc.startPreview(),this._previewed=!0))}},{key:"stopPreview",value:function(){this._rtc&&this._previewed&&(this.enableLocalVideo(!1),this._rtc.stopPreview(),this._previewed=!1)}},{key:"setAudio",value:function(e){return this._rtc?this.enableAudio(e):1}},{key:"setVideo",value:function(e){return this._rtc?this.enableVideo(e):1}},{key:"getSpeakerDevices",value:function(){if(this._rtc)return this._rtc.getAudioPlaybackDevices()}},{key:"getActiveSpeakerDevice",value:function(){if(this._rtc)return this._rtc.getCurrentAudioPlaybackDevice()}},{key:"setActiveSpeakerDevice",value:function(e){if(this._rtc&&e)return this._rtc.setAudioPlaybackDevice(e)}},{key:"setSpeakerVolume",value:function(e){if(this._rtc&&e){var t=p(e=e<0?0:e>100?100:e);return this._rtc.setAudioPlaybackVolume(t)}}},{key:"getSpeakerVolume",value:function(){if(this._rtc)return h(this._rtc.getAudioPlaybackVolume())}},{key:"startSpeakerTest",value:function(e){this._rtc&&e&&"string"==typeof e&&(this.stopSpeakerTest(),this._speakerTestState=0===this._rtc.startAudioPlaybackDeviceTest(e))}},{key:"stopSpeakerTest",value:function(){this._rtc&&this._speakerTestState&&(this._speakerTestState=0!==this._rtc.stopAudioPlaybackDeviceTest())}},{key:"getMicrophoneDevices",value:function(){if(this._rtc)return this._rtc.getAudioRecordingDevices()}},{key:"getActiveMicrophoneDevice",value:function(){if(this._rtc)return this._rtc.getCurrentAudioRecordingDevice()}},{key:"setActiveMicrophoneDevice",value:function(e){if(this._rtc&&e)return this._rtc.setAudioRecordingDevice(e)}},{key:"getMicrophoneVolume",value:function(){if(this._rtc)return h(this._rtc.getAudioRecordingVolume())}},{key:"setMicrophoneVolume",value:function(e){if(this._rtc&&e){var t=p(e=e<0?0:e>100?100:e);return this._rtc.setAudioRecordingVolume(t)}}},{key:"startMicrophoneTest",value:function(){this._rtc&&this._rtc.startAudioRecordingDeviceTest(200)}},{key:"stopMicrophoneTest",value:function(){this._rtc&&this._rtc.stopAudioRecordingDeviceTest()}},{key:"getCameraDevices",value:function(){if(this._rtc)return this._rtc.getVideoDevices()}},{key:"setCameraDevice",value:function(e){this._rtc&&e&&this._rtc.setVideoDevice(e)}},{key:"getActiveCameraDevice",value:function(){if(this._rtc)return this._rtc.getCurrentVideoDevice()}},{key:"startCameraTest",value:function(e){if(this._rtc){var t=document.querySelector("#".concat(e));this.enableLocalVideo(!0),this._rtc.setupLocalVideo(t),this._rtc.startVideoDeviceTest()}}},{key:"stopCameraTest",value:function(){this._rtc&&this._rtc.stopVideoDeviceTest()}},{key:"setVideoMirrorMode",value:function(e){if(this._rtc){var t=void 0===e||"boolean"!=typeof e?0:e?1:2;this._rtc.setLocalVideoMirrorMode(t)}}},{key:"createScreenShare",value:function(){if(this._rtc&&!this._inScreenShare&&this._screenShareToken&&this._screenShareUid){console.debug("createScreenShare:",this._appId,this._screenShareToken,this._screenShareUid);var e=this._rtc.videoSourceInitialize(this._appId);return!(e<0||(e=this._rtc.videoSourceSetChannelProfile(0),e<0||(e=this._rtc.videoSourceSetScreenCaptureContentHint(2),e<0||(this._rtc.setVideoRenderDimension(3,this._screenShareUid,1200,680),e=this._rtc.videoSourceJoin(this._screenShareToken,this._roomId,"",this._screenShareUid),e<0||(this._inScreenShare=!0,0)))))}}},{key:"getScreenDisplaysInfo",value:function(){if(this._rtc)return this._rtc.getScreenDisplaysInfo()}},{key:"startShareScreen",value:function(e){if(this._rtc&&this._inScreenShare){var t=[];this._rtc.videoSourceSetVideoProfile(43,!1),this._rtc.videoSourceStartScreenCaptureByScreen(e,{x:0,y:0,width:0,height:0},{width:1280,height:640,bitrate:500,frameRate:15,captureMouseCursor:!1,excludeWindowList:t,excludeWindowCount:t.length,windowFocus:!0})}}},{key:"getScreenWindowsInfo",value:function(){if(this._rtc)return this._rtc.getScreenWindowsInfo()}},{key:"startShareWindow",value:function(e){if(this._rtc&&this._inScreenShare){var t=[];this._rtc.videoSourceSetVideoProfile(43,!1),this._rtc.videoSourceStartScreenCaptureByWindow(e,{x:0,y:0,width:0,height:0},{width:1280,height:640,bitrate:500,frameRate:15,captureMouseCursor:!1,excludeWindowList:t,excludeWindowCount:t.length,windowFocus:!0})}}},{key:"stopScreenShare",value:function(){this._rtc&&this._inScreenShare&&this._rtc.stopScreenCapture2()}},{key:"startScreenSharePreview",value:function(e){if(this._rtc&&this._inScreenShare){var t=document.querySelector("#".concat(e));this._rtc.setupViewContentMode("videosource",1),this._rtc.setupViewContentMode(String(this._screenShareUid),1),this._rtc.setupLocalVideoSource(t),this._rtc.startScreenCapturePreview()}}},{key:"stopScreenSharePreview",value:function(){this._rtc&&this._inScreenShare&&this._rtc.stopScreenCapturePreview()}},{key:"destroyScreenShare",value:function(){this._inScreenShare&&(this.stopScreenShare(),this._rtc.videoSourceLeave(),this._rtc.videoSourceRelease(),this._inScreenShare=!1)}},{key:"changeAllRemoteStreamsMuteState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._rtc)return!1;var r=0;return(!t.hasOwnProperty("video")||t.video)&&(r=this._rtc.muteAllRemoteAudioStreams(e)),0===r&&(!t.hasOwnProperty("audio")||t.audio)&&(r=this._rtc.muteAllRemoteVideoStreams(e)),0===r}},{key:"changeRemoteVideoStreamMuteState",value:function(e,t){return!!this._rtc&&0===this._rtc.muteRemoteVideoStream(e,t)}},{key:"changeRemoteAudioStreamMuteState",value:function(e,t){if(this._rtc)return 0===this._rtc.muteRemoteAudioStream(e,t)}},{key:"initRender",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._rtc){t&&t!==this._uid||(t="local");var r=document.querySelector("#".concat(e));this._rtc.initRender(t,r,this._roomId)}}},{key:"resizeRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._rtc&&(e&&e!==this._uid||(e="local"),this._rtc.resizeRender(e))}},{key:"destroyRender",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._rtc&&(e&&e!==this._uid||(e="local"),this._rtc.destroyRender(e,this._roomId))}},{key:"setVideoRenderDimension",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n="local"===(r=r&&r!==this._uid?r:"local")?0:1;this._rtc.setVideoRenderDimension(n,r,e,t)}},{key:"enableVirtualBackground",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.VituralBackgroundType.Color,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._rtc)return-1;var o={background_source_type:t};return n.hasOwnProperty("color")?o.color=n.color:o.color=16777215,n.hasOwnProperty("source")&&(o.source=n.source),this._rtc.enableVirtualBackground(e,o)}}],[{key:"convertNetworkQuality",value:function(e){return y[e.toString()]}}]),r}(function(){function e(){_classCallCheck(this,e),this._bus=new i.default,this._joined=!1,this._audioUsable=!0,this._videoUsable=!0,this._published=!1,this._uid=null,this._roomId=null,this._endTime=null,this._remoteStreams={}}return _createClass(e,[{key:"audioUsable",get:function(){return this._audioUsable}},{key:"published",get:function(){return this._published}},{key:"videoUsable",get:function(){return this._videoUsable},set:function(e){"boolean"==typeof e?this._videoUsable=e:console.warn("[DxzChatClient] usable must be bool")}},{key:"remoteUsersCount",get:function(){var e,t=this;return _filterInstanceProperty(e=_Object$keys(this._remoteStreams)).call(e,(function(e){return!0===t._remoteStreams[e]})).length}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.hasOwnProperty("eventTrigger")&&(this._bus=e.eventTrigger)}},{key:"destroy",value:function(){}},{key:"bindEvents",value:function(){}},{key:"join",value:function(){}},{key:"leave",value:function(){}},{key:"publish",value:function(e){}},{key:"unpublish",value:function(){}},{key:"play",value:function(){}},{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"unsubscribeAll",value:function(){}},{key:"startPreview",value:function(){}},{key:"stopPreview",value:function(){}},{key:"setAudio",value:function(e){}},{key:"setAudioById",value:function(e,t){}},{key:"setVideo",value:function(e){}},{key:"setVideoById",value:function(e,t){}},{key:"switchAudioUsable",value:function(){this._audioUsable=!this._audioUsable}},{key:"switchVideoUsable",value:function(){this._videoUsable=!this._videoUsable}}]),e}());m.RtcProfile={VideoCall:0,Live:1,Game:2},m.VituralBackgroundType={Color:1,Img:2},m.RTCEvents=R;var v={agora:m};function b(e){if(!v.hasOwnProperty(e))throw Error("invalid vendor type");return new v[e]}var I={NETWORK_QUALITY:"rtc-test-network-quality",NETWORK_RESULT:"rtc-test-network-result",VIDEO_DEVICE_CHANGE:"rtc-test-video-device-change",AUDIO_DEVICE_CHANGE:"rtc-test-audio-device-change",AUDIO_LEVEL_CHANGE:"rtc-test-audio-level-change"},R={ERROR:"rtc-error",LOCAL_JOIN:"rtc-local-join",LOCAL_LEAVE:"rtc-local-leave",REMOTE_USER_JOIN:"rtc-remote-user-join",REMOTE_USER_LEAVE:"rtc-remote-user-leave",AUDIO_VOLUME_IND:"rtc-audio-volume-indication",AUDIO_LEVEL_CHANGE:"rtc-audio-level",AUDIO_DEVICE_STATE_CHANGE:"rtc-audio-device-state-changed",VIDEO_DEVICE_STATE_CHANGE:"rtc-video-device-state-changed",AUDIO_MIXING_STATE:"rtc-audio-mixing-state",LOCAL_NETWORK_QUALITY:"rtc-local-network-quality",REMOTE_NETWORK_QUALITY:"rtc-remote-network-quality",VIDEO_SIZE_CHANGE:"rtc-video-size-change",CONNECTION_LOST:"rtc-connection-lost",SCREEN_SHARE_JOIN:"rtc-screen-share-join",SCREEN_SHARE_LEAVE:"rtc-screen-share-leave",REMOTE_VIDEO_FIRST_FRAME:"rtc-remote-video-first-frame",REMOTE_VIDEO_OFF:"rtc-remote-video-off",REMOTE_VIDEO_ON:"rtc-remote-video-on",REMOTE_AUDIO_OFF:"rtc-remote-audio-mute",REMOTE_AUDIO_ON:"rtc-remote-audio-unmute",LOCAL_USER_BANNED:"rtc-local-user-banned",LOCAL_USER_VIDEO_UNPUBLISHED:"rtc-local-user-video-unpublished",LOCAL_USER_VIDEO_PUBLISHED:"rtc-local-user-video-published",LOCAL_USER_AUDIO_UNPUBLISHED:"rtc-local-user-audio-unpublished",LOCAL_USER_AUDIO_PUBLISHED:"rtc-local-user-audio-published",LOCAL_USER_ONLINE:"rtc-local-user-online",LOCAL_USER_OFFLINE:"rtc-local-user-offline",REMOTE_STREAM_SUBSCRIBED:"rtc-remote-stream-subscribed",REMOTE_STREAM_UNSUBSCRIBED:"rtc-remote-stream-unsubscribed",ACTIVE_USER:"rtc-new-active-user"},S=void 0!==_globalThis?_globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},O=function(e,t){return function(e,t){e.exports=function(e,t,r){var n,o;function i(e){return e&&"object"==_typeof(e)&&"default"in e?e:{default:e}}var s=i(e),a=i(t),c=i(r),u=void 0!==S?S:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};u.setTimeout,u.clearTimeout;var l=u.performance||{};l.now||l.mozNow||l.msNow||l.oNow||l.webkitNow;var d={LOCAL_USER_JOIN_SUCCESS:"rtm-local-user-join-success",LOCAL_USER_JOIN_FAIL:"rtm-local-user-join-fail",MEMBER_ONLINE:"rtm-member-onLine",MEMBER_OFFLINE:"rtm-member-offline",SYNC_ROOM_ATTR:"rtm-sync-room-attr",SYNC_USER_ATTR:"rtm-sync-user-attr",CONTROL_MESSAGE:"rtm-control-message",CHAT_MESSAGE:"rtm-chat-message",CUSTOM_MESSAGE:"custom-message",ROOM_ATTR_UPDATE:"rtm-room-attr-update",USER_ATTR_UPDATE:"rtm-user-attr-update",USER_ATTR_INIT:"rtm-user-attr-init",ROOM_START:"rtm-room-start",ROOM_STOP:"rtm-room-stop",CONNECTED:"rtm-server-connected",RECONNECTED:"rtm-server-reconnected",RECONNECTING:"rtm-server-reconnecting",RECONNECT_MAX_TIME:"rtm-server-reconnect-max-time",KICK_OUT:"rtm-kick-out",REMOTE_LOGIN:"rtm-remote-login",WHITEBOARD_MESSAGE:"rtm-whiteboard-message"},_={Control:"control",Chat:"chat",Whiteboard:"whiteboard",Custom:"custom"},h={chat:d.CHAT_MESSAGE,control:d.CONTROL_MESSAGE,whiteboard:d.WHITEBOARD_MESSAGE,custom:d.CUSTOM_MESSAGE},p="lvp-local-user-join-success",f="lvp-local-user-join-fail",y="lvp-custom-peer-message",g="lvp-custom-room-message",m="lvp-RoomStatusStart",v="lvp-RoomStatusStop",b="lvp-UserStatusOnLine",I="lvp-UserStatusOffline",R="lvp-roomAttrUpdate",O="lvp-UserAttrUpdate",E="lvp-user-attr-init",T="lvp-SyncRoomAttr",k="lvp-SyncUserAttr",w="lvp-connected",A="lvp-reconnected",P="lvp-reconnecting",C="lvp-reconnect-max-time",M="lvp-kick-out",U="lvp-remote-login",j="socket-connected",L="socket-reconnecting",N="socket-reconnected",D="socket-reconnect-max-time",V="socket-server-connect-error",x={Room:"room",Peer:"peer"},q=1e4;function B(){return++q}var K={LVP_SERVER_TOKEN_IS_NULL:{no:B(),msg:"token is null"},LVP_SERVER_USER_ID_IS_NONE:{no:B(),msg:"user id is null"},LVP_SERVER_ROOM_ID_IS_NONE:{no:B(),msg:"channel id is null"},LVP_SERVER_APP_KEY_IS_NONE:{no:B(),msg:"end time is null"},WEBSOCKET_URL_IS_NULL:{no:B(),msg:"web socket uri is null"}},J=a.default.create({baseURL:"",timeout:5e3});function H(e){J.defaults.baseURL="".concat(e)}function $(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return J.post("/client/set_room_attrs",{room_id:e,attrs:t})}J.defaults.validateStatus=function(e){return/^(2|3)\d{2}$/.test(e)},J.defaults.headers["Content-Type"]="application/json;charset=UTF-8",J.defaults.responseType="json",J.interceptors.response.use((function(e){return e.data}),(function(e){return _Promise.reject(e)}));var F=c.default.Reader,G=c.default.Writer,W=c.default.util,Q=c.default.roots.default||(c.default.roots.default={});Q.pb=function(){var e,t,r={};return r.PackageType=((t=_Object$create(e={}))[e[0]="PT_UNKNOWN"]=0,t[e[1]="PT_HEARTBEAT"]=1,t[e[2]="PT_SYNC_ROOM_ATTR"]=2,t[e[3]="PT_SYNC_USER_ATTR"]=3,t[e[4]="PT_JOIN_ROOM"]=4,t[e[5]="PT_LEAVE_ROOM"]=5,t[e[6]="PT_USER_ATTR"]=6,t[e[7]="PT_ROOM_ATTR"]=7,t[e[8]="PT_MESSAGE"]=8,t[e[9]="PT_MONITOR_DATA"]=9,t[e[10]="PT_REMOTE_LOGIN"]=10,t),r.ConnExtError=function(){var e={},t=_Object$create(e);return t[e[0]="ErrSuccessful"]=0,t[e[30553]="ErrRepeatedLoginWebsocket"]=30553,t}(),r.ConnExtErrorCode=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Code=0,e.prototype.Message="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.Code&&Object.hasOwnProperty.call(e,"Code")&&t.uint32(8).int32(e.Code),null!=e.Message&&Object.hasOwnProperty.call(e,"Message")&&t.uint32(18).string(e.Message),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.ConnExtErrorCode;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Code=e.int32();break;case 2:n.Message=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.Code&&e.hasOwnProperty("Code")&&!W.isInteger(e.Code)?"Code: integer expected":null!=e.Message&&e.hasOwnProperty("Message")&&!W.isString(e.Message)?"Message: string expected":null},e.fromObject=function(e){if(e instanceof Q.pb.ConnExtErrorCode)return e;var t=new Q.pb.ConnExtErrorCode;return null!=e.Code&&(t.Code=0|e.Code),null!=e.Message&&(t.Message=String(e.Message)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Code=0,r.Message=""),null!=e.Code&&e.hasOwnProperty("Code")&&(r.Code=e.Code),null!=e.Message&&e.hasOwnProperty("Message")&&(r.Message=e.Message),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.Message=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.ReceiverType=0,e.prototype.ReceiverId=0,e.prototype.Category="",e.prototype.MessageContent="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.ReceiverType&&Object.hasOwnProperty.call(e,"ReceiverType")&&t.uint32(8).int32(e.ReceiverType),null!=e.ReceiverId&&Object.hasOwnProperty.call(e,"ReceiverId")&&t.uint32(16).int32(e.ReceiverId),null!=e.Category&&Object.hasOwnProperty.call(e,"Category")&&t.uint32(26).string(e.Category),null!=e.MessageContent&&Object.hasOwnProperty.call(e,"MessageContent")&&t.uint32(34).string(e.MessageContent),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.Message;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.ReceiverType=e.int32();break;case 2:n.ReceiverId=e.int32();break;case 3:n.Category=e.string();break;case 4:n.MessageContent=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=_typeof(e)||null===e)return"object expected";if(null!=e.ReceiverType&&e.hasOwnProperty("ReceiverType"))switch(e.ReceiverType){default:return"ReceiverType: enum value expected";case 0:case 1:case 2:}return null!=e.ReceiverId&&e.hasOwnProperty("ReceiverId")&&!W.isInteger(e.ReceiverId)?"ReceiverId: integer expected":null!=e.Category&&e.hasOwnProperty("Category")&&!W.isString(e.Category)?"Category: string expected":null!=e.MessageContent&&e.hasOwnProperty("MessageContent")&&!W.isString(e.MessageContent)?"MessageContent: string expected":null},e.fromObject=function(e){if(e instanceof Q.pb.Message)return e;var t=new Q.pb.Message;switch(e.ReceiverType){case"RT_UNKNOWN":case 0:t.ReceiverType=0;break;case"RT_USER":case 1:t.ReceiverType=1;break;case"RT_ROOM":case 2:t.ReceiverType=2}return null!=e.ReceiverId&&(t.ReceiverId=0|e.ReceiverId),null!=e.Category&&(t.Category=String(e.Category)),null!=e.MessageContent&&(t.MessageContent=String(e.MessageContent)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.ReceiverType=t.enums===String?"RT_UNKNOWN":0,r.ReceiverId=0,r.Category="",r.MessageContent=""),null!=e.ReceiverType&&e.hasOwnProperty("ReceiverType")&&(r.ReceiverType=t.enums===String?Q.pb.ReceiverType[e.ReceiverType]:e.ReceiverType),null!=e.ReceiverId&&e.hasOwnProperty("ReceiverId")&&(r.ReceiverId=e.ReceiverId),null!=e.Category&&e.hasOwnProperty("Category")&&(r.Category=e.Category),null!=e.MessageContent&&e.hasOwnProperty("MessageContent")&&(r.MessageContent=e.MessageContent),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.Input=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.RequestId=W.Long?W.Long.fromBits(0,0,!1):0,e.prototype.Data=W.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.Type&&Object.hasOwnProperty.call(e,"Type")&&t.uint32(8).int32(e.Type),null!=e.RequestId&&Object.hasOwnProperty.call(e,"RequestId")&&t.uint32(16).int64(e.RequestId),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(26).bytes(e.Data),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.Input;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Type=e.int32();break;case 2:n.RequestId=e.int64();break;case 3:n.Data=e.bytes();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=_typeof(e)||null===e)return"object expected";if(null!=e.Type&&e.hasOwnProperty("Type"))switch(e.Type){default:return"Type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:}return null!=e.RequestId&&e.hasOwnProperty("RequestId")&&!(W.isInteger(e.RequestId)||e.RequestId&&W.isInteger(e.RequestId.low)&&W.isInteger(e.RequestId.high))?"RequestId: integer|Long expected":null!=e.Data&&e.hasOwnProperty("Data")&&!(e.Data&&"number"==typeof e.Data.length||W.isString(e.Data))?"Data: buffer expected":null},e.fromObject=function(e){if(e instanceof Q.pb.Input)return e;var t=new Q.pb.Input;switch(e.Type){case"PT_UNKNOWN":case 0:t.Type=0;break;case"PT_HEARTBEAT":case 1:t.Type=1;break;case"PT_SYNC_ROOM_ATTR":case 2:t.Type=2;break;case"PT_SYNC_USER_ATTR":case 3:t.Type=3;break;case"PT_JOIN_ROOM":case 4:t.Type=4;break;case"PT_LEAVE_ROOM":case 5:t.Type=5;break;case"PT_USER_ATTR":case 6:t.Type=6;break;case"PT_ROOM_ATTR":case 7:t.Type=7;break;case"PT_MESSAGE":case 8:t.Type=8;break;case"PT_MONITOR_DATA":case 9:t.Type=9;break;case"PT_REMOTE_LOGIN":case 10:t.Type=10}return null!=e.RequestId&&(W.Long?(t.RequestId=W.Long.fromValue(e.RequestId)).unsigned=!1:"string"==typeof e.RequestId?t.RequestId=_parseInt(e.RequestId,10):"number"==typeof e.RequestId?t.RequestId=e.RequestId:"object"==_typeof(e.RequestId)&&(t.RequestId=new W.LongBits(e.RequestId.low>>>0,e.RequestId.high>>>0).toNumber())),null!=e.Data&&("string"==typeof e.Data?W.base64.decode(e.Data,t.Data=W.newBuffer(W.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(r.Type=t.enums===String?"PT_UNKNOWN":0,W.Long){var n=new W.Long(0,0,!1);r.RequestId=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.RequestId=t.longs===String?"0":0;t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=W.newBuffer(r.Data)))}return null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?Q.pb.PackageType[e.Type]:e.Type),null!=e.RequestId&&e.hasOwnProperty("RequestId")&&("number"==typeof e.RequestId?r.RequestId=t.longs===String?String(e.RequestId):e.RequestId:r.RequestId=t.longs===String?W.Long.prototype.toString.call(e.RequestId):t.longs===Number?new W.LongBits(e.RequestId.low>>>0,e.RequestId.high>>>0).toNumber():e.RequestId),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?W.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?_sliceInstanceProperty(Array.prototype).call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.Output=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Type=0,e.prototype.RequestId=W.Long?W.Long.fromBits(0,0,!1):0,e.prototype.Code=0,e.prototype.ErrMessage="",e.prototype.Data=W.newBuffer([]),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.Type&&Object.hasOwnProperty.call(e,"Type")&&t.uint32(8).int32(e.Type),null!=e.RequestId&&Object.hasOwnProperty.call(e,"RequestId")&&t.uint32(16).int64(e.RequestId),null!=e.Code&&Object.hasOwnProperty.call(e,"Code")&&t.uint32(24).int32(e.Code),null!=e.ErrMessage&&Object.hasOwnProperty.call(e,"ErrMessage")&&t.uint32(34).string(e.ErrMessage),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(42).bytes(e.Data),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.Output;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Type=e.int32();break;case 2:n.RequestId=e.int64();break;case 3:n.Code=e.int32();break;case 4:n.ErrMessage=e.string();break;case 5:n.Data=e.bytes();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=_typeof(e)||null===e)return"object expected";if(null!=e.Type&&e.hasOwnProperty("Type"))switch(e.Type){default:return"Type: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:}return null!=e.RequestId&&e.hasOwnProperty("RequestId")&&!(W.isInteger(e.RequestId)||e.RequestId&&W.isInteger(e.RequestId.low)&&W.isInteger(e.RequestId.high))?"RequestId: integer|Long expected":null!=e.Code&&e.hasOwnProperty("Code")&&!W.isInteger(e.Code)?"Code: integer expected":null!=e.ErrMessage&&e.hasOwnProperty("ErrMessage")&&!W.isString(e.ErrMessage)?"ErrMessage: string expected":null!=e.Data&&e.hasOwnProperty("Data")&&!(e.Data&&"number"==typeof e.Data.length||W.isString(e.Data))?"Data: buffer expected":null},e.fromObject=function(e){if(e instanceof Q.pb.Output)return e;var t=new Q.pb.Output;switch(e.Type){case"PT_UNKNOWN":case 0:t.Type=0;break;case"PT_HEARTBEAT":case 1:t.Type=1;break;case"PT_SYNC_ROOM_ATTR":case 2:t.Type=2;break;case"PT_SYNC_USER_ATTR":case 3:t.Type=3;break;case"PT_JOIN_ROOM":case 4:t.Type=4;break;case"PT_LEAVE_ROOM":case 5:t.Type=5;break;case"PT_USER_ATTR":case 6:t.Type=6;break;case"PT_ROOM_ATTR":case 7:t.Type=7;break;case"PT_MESSAGE":case 8:t.Type=8;break;case"PT_MONITOR_DATA":case 9:t.Type=9;break;case"PT_REMOTE_LOGIN":case 10:t.Type=10}return null!=e.RequestId&&(W.Long?(t.RequestId=W.Long.fromValue(e.RequestId)).unsigned=!1:"string"==typeof e.RequestId?t.RequestId=_parseInt(e.RequestId,10):"number"==typeof e.RequestId?t.RequestId=e.RequestId:"object"==_typeof(e.RequestId)&&(t.RequestId=new W.LongBits(e.RequestId.low>>>0,e.RequestId.high>>>0).toNumber())),null!=e.Code&&(t.Code=0|e.Code),null!=e.ErrMessage&&(t.ErrMessage=String(e.ErrMessage)),null!=e.Data&&("string"==typeof e.Data?W.base64.decode(e.Data,t.Data=W.newBuffer(W.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(r.Type=t.enums===String?"PT_UNKNOWN":0,W.Long){var n=new W.Long(0,0,!1);r.RequestId=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.RequestId=t.longs===String?"0":0;r.Code=0,r.ErrMessage="",t.bytes===String?r.Data="":(r.Data=[],t.bytes!==Array&&(r.Data=W.newBuffer(r.Data)))}return null!=e.Type&&e.hasOwnProperty("Type")&&(r.Type=t.enums===String?Q.pb.PackageType[e.Type]:e.Type),null!=e.RequestId&&e.hasOwnProperty("RequestId")&&("number"==typeof e.RequestId?r.RequestId=t.longs===String?String(e.RequestId):e.RequestId:r.RequestId=t.longs===String?W.Long.prototype.toString.call(e.RequestId):t.longs===Number?new W.LongBits(e.RequestId.low>>>0,e.RequestId.high>>>0).toNumber():e.RequestId),null!=e.Code&&e.hasOwnProperty("Code")&&(r.Code=e.Code),null!=e.ErrMessage&&e.hasOwnProperty("ErrMessage")&&(r.ErrMessage=e.ErrMessage),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=t.bytes===String?W.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?_sliceInstanceProperty(Array.prototype).call(e.Data):e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.UserInfo=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.UserId=0,e.prototype.UserExtId=W.Long?W.Long.fromBits(0,0,!0):0,e.prototype.UserName="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.UserId&&Object.hasOwnProperty.call(e,"UserId")&&t.uint32(8).int32(e.UserId),null!=e.UserExtId&&Object.hasOwnProperty.call(e,"UserExtId")&&t.uint32(16).uint64(e.UserExtId),null!=e.UserName&&Object.hasOwnProperty.call(e,"UserName")&&t.uint32(26).string(e.UserName),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.UserInfo;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.UserId=e.int32();break;case 2:n.UserExtId=e.uint64();break;case 3:n.UserName=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.UserId&&e.hasOwnProperty("UserId")&&!W.isInteger(e.UserId)?"UserId: integer expected":null!=e.UserExtId&&e.hasOwnProperty("UserExtId")&&!(W.isInteger(e.UserExtId)||e.UserExtId&&W.isInteger(e.UserExtId.low)&&W.isInteger(e.UserExtId.high))?"UserExtId: integer|Long expected":null!=e.UserName&&e.hasOwnProperty("UserName")&&!W.isString(e.UserName)?"UserName: string expected":null},e.fromObject=function(e){if(e instanceof Q.pb.UserInfo)return e;var t=new Q.pb.UserInfo;return null!=e.UserId&&(t.UserId=0|e.UserId),null!=e.UserExtId&&(W.Long?(t.UserExtId=W.Long.fromValue(e.UserExtId)).unsigned=!0:"string"==typeof e.UserExtId?t.UserExtId=_parseInt(e.UserExtId,10):"number"==typeof e.UserExtId?t.UserExtId=e.UserExtId:"object"==_typeof(e.UserExtId)&&(t.UserExtId=new W.LongBits(e.UserExtId.low>>>0,e.UserExtId.high>>>0).toNumber(!0))),null!=e.UserName&&(t.UserName=String(e.UserName)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(r.UserId=0,W.Long){var n=new W.Long(0,0,!0);r.UserExtId=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.UserExtId=t.longs===String?"0":0;r.UserName=""}return null!=e.UserId&&e.hasOwnProperty("UserId")&&(r.UserId=e.UserId),null!=e.UserExtId&&e.hasOwnProperty("UserExtId")&&("number"==typeof e.UserExtId?r.UserExtId=t.longs===String?String(e.UserExtId):e.UserExtId:r.UserExtId=t.longs===String?W.Long.prototype.toString.call(e.UserExtId):t.longs===Number?new W.LongBits(e.UserExtId.low>>>0,e.UserExtId.high>>>0).toNumber(!0):e.UserExtId),null!=e.UserName&&e.hasOwnProperty("UserName")&&(r.UserName=e.UserName),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.SyncRoomAttrInput=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.SyncRoomAttrInput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId)?"RoomId: integer expected":null},e.fromObject=function(e){if(e instanceof Q.pb.SyncRoomAttrInput)return e;var t=new Q.pb.SyncRoomAttrInput;return null!=e.RoomId&&(t.RoomId=0|e.RoomId),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.RoomId=0),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.SyncRoomAttrOutput=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.prototype.Attrs="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),null!=e.Attrs&&Object.hasOwnProperty.call(e,"Attrs")&&t.uint32(18).string(e.Attrs),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.SyncRoomAttrOutput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;case 2:n.Attrs=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId)?"RoomId: integer expected":null!=e.Attrs&&e.hasOwnProperty("Attrs")&&!W.isString(e.Attrs)?"Attrs: string expected":null},e.fromObject=function(e){if(e instanceof Q.pb.SyncRoomAttrOutput)return e;var t=new Q.pb.SyncRoomAttrOutput;return null!=e.RoomId&&(t.RoomId=0|e.RoomId),null!=e.Attrs&&(t.Attrs=String(e.Attrs)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.RoomId=0,r.Attrs=""),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),null!=e.Attrs&&e.hasOwnProperty("Attrs")&&(r.Attrs=e.Attrs),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.UserAttrs=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.UserId=0,e.prototype.Attrs="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.UserId&&Object.hasOwnProperty.call(e,"UserId")&&t.uint32(8).int32(e.UserId),null!=e.Attrs&&Object.hasOwnProperty.call(e,"Attrs")&&t.uint32(18).string(e.Attrs),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.UserAttrs;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.UserId=e.int32();break;case 2:n.Attrs=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.UserId&&e.hasOwnProperty("UserId")&&!W.isInteger(e.UserId)?"UserId: integer expected":null!=e.Attrs&&e.hasOwnProperty("Attrs")&&!W.isString(e.Attrs)?"Attrs: string expected":null},e.fromObject=function(e){if(e instanceof Q.pb.UserAttrs)return e;var t=new Q.pb.UserAttrs;return null!=e.UserId&&(t.UserId=0|e.UserId),null!=e.Attrs&&(t.Attrs=String(e.Attrs)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.UserId=0,r.Attrs=""),null!=e.UserId&&e.hasOwnProperty("UserId")&&(r.UserId=e.UserId),null!=e.Attrs&&e.hasOwnProperty("Attrs")&&(r.Attrs=e.Attrs),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.KeyValues=function(){function e(e){if(this.Values=[],e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Key="",e.prototype.Values=W.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=G.create()),null!=e.Key&&Object.hasOwnProperty.call(e,"Key")&&t.uint32(10).string(e.Key),null!=e.Values&&e.Values.length)for(var r=0;r<e.Values.length;++r)t.uint32(18).string(e.Values[r]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.KeyValues;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Key=e.string();break;case 2:n.Values&&n.Values.length||(n.Values=[]),n.Values.push(e.string());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=_typeof(e)||null===e)return"object expected";if(null!=e.Key&&e.hasOwnProperty("Key")&&!W.isString(e.Key))return"Key: string expected";if(null!=e.Values&&e.hasOwnProperty("Values")){if(!_Array$isArray(e.Values))return"Values: array expected";for(var t=0;t<e.Values.length;++t)if(!W.isString(e.Values[t]))return"Values: string[] expected"}return null},e.fromObject=function(e){if(e instanceof Q.pb.KeyValues)return e;var t=new Q.pb.KeyValues;if(null!=e.Key&&(t.Key=String(e.Key)),e.Values){if(!_Array$isArray(e.Values))throw TypeError(".pb.KeyValues.Values: array expected");t.Values=[];for(var r=0;r<e.Values.length;++r)t.Values[r]=String(e.Values[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.Values=[]),t.defaults&&(r.Key=""),null!=e.Key&&e.hasOwnProperty("Key")&&(r.Key=e.Key),e.Values&&e.Values.length){r.Values=[];for(var n=0;n<e.Values.length;++n)r.Values[n]=e.Values[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.SyncUserAttrInput=function(){function e(e){if(this.Keys=[],e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.prototype.Keys=W.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),null!=e.Keys&&e.Keys.length)for(var r=0;r<e.Keys.length;++r)Q.pb.KeyValues.encode(e.Keys[r],t.uint32(18).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.SyncUserAttrInput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;case 2:n.Keys&&n.Keys.length||(n.Keys=[]),n.Keys.push(Q.pb.KeyValues.decode(e,e.uint32()));break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=_typeof(e)||null===e)return"object expected";if(null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId))return"RoomId: integer expected";if(null!=e.Keys&&e.hasOwnProperty("Keys")){if(!_Array$isArray(e.Keys))return"Keys: array expected";for(var t=0;t<e.Keys.length;++t){var r=Q.pb.KeyValues.verify(e.Keys[t]);if(r)return"Keys."+r}}return null},e.fromObject=function(e){if(e instanceof Q.pb.SyncUserAttrInput)return e;var t=new Q.pb.SyncUserAttrInput;if(null!=e.RoomId&&(t.RoomId=0|e.RoomId),e.Keys){if(!_Array$isArray(e.Keys))throw TypeError(".pb.SyncUserAttrInput.Keys: array expected");t.Keys=[];for(var r=0;r<e.Keys.length;++r){if("object"!=_typeof(e.Keys[r]))throw TypeError(".pb.SyncUserAttrInput.Keys: object expected");t.Keys[r]=Q.pb.KeyValues.fromObject(e.Keys[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.Keys=[]),t.defaults&&(r.RoomId=0),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),e.Keys&&e.Keys.length){r.Keys=[];for(var n=0;n<e.Keys.length;++n)r.Keys[n]=Q.pb.KeyValues.toObject(e.Keys[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.SyncUserAttrOutput=function(){function e(e){if(this.AttrsList=[],e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.prototype.AttrsList=W.emptyArray,e.prototype.HasMore=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),null!=e.AttrsList&&e.AttrsList.length)for(var r=0;r<e.AttrsList.length;++r)Q.pb.UserAttrs.encode(e.AttrsList[r],t.uint32(18).fork()).ldelim();return null!=e.HasMore&&Object.hasOwnProperty.call(e,"HasMore")&&t.uint32(24).bool(e.HasMore),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.SyncUserAttrOutput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;case 2:n.AttrsList&&n.AttrsList.length||(n.AttrsList=[]),n.AttrsList.push(Q.pb.UserAttrs.decode(e,e.uint32()));break;case 3:n.HasMore=e.bool();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=_typeof(e)||null===e)return"object expected";if(null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId))return"RoomId: integer expected";if(null!=e.AttrsList&&e.hasOwnProperty("AttrsList")){if(!_Array$isArray(e.AttrsList))return"AttrsList: array expected";for(var t=0;t<e.AttrsList.length;++t){var r=Q.pb.UserAttrs.verify(e.AttrsList[t]);if(r)return"AttrsList."+r}}return null!=e.HasMore&&e.hasOwnProperty("HasMore")&&"boolean"!=typeof e.HasMore?"HasMore: boolean expected":null},e.fromObject=function(e){if(e instanceof Q.pb.SyncUserAttrOutput)return e;var t=new Q.pb.SyncUserAttrOutput;if(null!=e.RoomId&&(t.RoomId=0|e.RoomId),e.AttrsList){if(!_Array$isArray(e.AttrsList))throw TypeError(".pb.SyncUserAttrOutput.AttrsList: array expected");t.AttrsList=[];for(var r=0;r<e.AttrsList.length;++r){if("object"!=_typeof(e.AttrsList[r]))throw TypeError(".pb.SyncUserAttrOutput.AttrsList: object expected");t.AttrsList[r]=Q.pb.UserAttrs.fromObject(e.AttrsList[r])}}return null!=e.HasMore&&(t.HasMore=Boolean(e.HasMore)),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.AttrsList=[]),t.defaults&&(r.RoomId=0,r.HasMore=!1),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),e.AttrsList&&e.AttrsList.length){r.AttrsList=[];for(var n=0;n<e.AttrsList.length;++n)r.AttrsList[n]=Q.pb.UserAttrs.toObject(e.AttrsList[n],t)}return null!=e.HasMore&&e.hasOwnProperty("HasMore")&&(r.HasMore=e.HasMore),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.JoinRoomInput=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.JoinRoomInput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId)?"RoomId: integer expected":null},e.fromObject=function(e){if(e instanceof Q.pb.JoinRoomInput)return e;var t=new Q.pb.JoinRoomInput;return null!=e.RoomId&&(t.RoomId=0|e.RoomId),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.RoomId=0),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.JoinRoomOutput=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.JoinRoomOutput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId)?"RoomId: integer expected":null},e.fromObject=function(e){if(e instanceof Q.pb.JoinRoomOutput)return e;var t=new Q.pb.JoinRoomOutput;return null!=e.RoomId&&(t.RoomId=0|e.RoomId),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.RoomId=0),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.LeaveRoomInput=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.LeaveRoomInput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId)?"RoomId: integer expected":null},e.fromObject=function(e){if(e instanceof Q.pb.LeaveRoomInput)return e;var t=new Q.pb.LeaveRoomInput;return null!=e.RoomId&&(t.RoomId=0|e.RoomId),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.RoomId=0),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.LeaveRoomOutput=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.RoomId=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.RoomId&&Object.hasOwnProperty.call(e,"RoomId")&&t.uint32(8).int32(e.RoomId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.LeaveRoomOutput;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.RoomId=e.int32();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.RoomId&&e.hasOwnProperty("RoomId")&&!W.isInteger(e.RoomId)?"RoomId: integer expected":null},e.fromObject=function(e){if(e instanceof Q.pb.LeaveRoomOutput)return e;var t=new Q.pb.LeaveRoomOutput;return null!=e.RoomId&&(t.RoomId=0|e.RoomId),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.RoomId=0),null!=e.RoomId&&e.hasOwnProperty("RoomId")&&(r.RoomId=e.RoomId),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.ReceiverType=function(){var e={},t=_Object$create(e);return t[e[0]="RT_UNKNOWN"]=0,t[e[1]="RT_USER"]=1,t[e[2]="RT_ROOM"]=2,t}(),r.MessageSend=function(){function e(e){if(this.Messages=[],e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Messages=W.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=G.create()),null!=e.Messages&&e.Messages.length)for(var r=0;r<e.Messages.length;++r)t.uint32(10).string(e.Messages[r]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.MessageSend;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Messages&&n.Messages.length||(n.Messages=[]),n.Messages.push(e.string());break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=_typeof(e)||null===e)return"object expected";if(null!=e.Messages&&e.hasOwnProperty("Messages")){if(!_Array$isArray(e.Messages))return"Messages: array expected";for(var t=0;t<e.Messages.length;++t)if(!W.isString(e.Messages[t]))return"Messages: string[] expected"}return null},e.fromObject=function(e){if(e instanceof Q.pb.MessageSend)return e;var t=new Q.pb.MessageSend;if(e.Messages){if(!_Array$isArray(e.Messages))throw TypeError(".pb.MessageSend.Messages: array expected");t.Messages=[];for(var r=0;r<e.Messages.length;++r)t.Messages[r]=String(e.Messages[r])}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.Messages=[]),e.Messages&&e.Messages.length){r.Messages=[];for(var n=0;n<e.Messages.length;++n)r.Messages[n]=e.Messages[n]}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.SenderType=function(){var e={},t=_Object$create(e);return t[e[0]="ST_UNKNOWN"]=0,t[e[1]="ST_SYSTEM"]=1,t[e[2]="ST_USER"]=2,t}(),r.MessageStatus=function(){var e={},t=_Object$create(e);return t[e[0]="MS_UNKNOWN"]=0,t[e[1]="MS_NORMAL"]=1,t[e[2]="MS_RECALL"]=2,t}(),r.MonitorData=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.Data="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(10).string(e.Data),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.MonitorData;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.Data=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.Data&&e.hasOwnProperty("Data")&&!W.isString(e.Data)?"Data: string expected":null},e.fromObject=function(e){if(e instanceof Q.pb.MonitorData)return e;var t=new Q.pb.MonitorData;return null!=e.Data&&(t.Data=String(e.Data)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.Data=""),null!=e.Data&&e.hasOwnProperty("Data")&&(r.Data=e.Data),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r.RemoteLogin=function(){function e(e){if(e)for(var t=_Object$keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.System="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=G.create()),null!=e.System&&Object.hasOwnProperty.call(e,"System")&&t.uint32(10).string(e.System),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof F||(e=F.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new Q.pb.RemoteLogin;e.pos<r;){var o=e.uint32();switch(o>>>3){case 1:n.System=e.string();break;default:e.skipType(7&o)}}return n},e.decodeDelimited=function(e){return e instanceof F||(e=new F(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=_typeof(e)||null===e?"object expected":null!=e.System&&e.hasOwnProperty("System")&&!W.isString(e.System)?"System: string expected":null},e.fromObject=function(e){if(e instanceof Q.pb.RemoteLogin)return e;var t=new Q.pb.RemoteLogin;return null!=e.System&&(t.System=String(e.System)),t},e.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(r.System=""),null!=e.System&&e.hasOwnProperty("System")&&(r.System=e.System),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,c.default.util.toJSONOptions)},e}(),r}();var Y=Q,z=Y.pb,X=new _Map(_mapInstanceProperty(n=_Object$keys(z.PackageType)).call(n,(function(e){return[z.PackageType[e],e]}))),Z=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,r),(e=t.call(this))._ws=null,!n.hasOwnProperty("wsUrl"))throw K.WEBSOCKET_URL_IS_NULL;return e._wsUrl=n.wsUrl,e._alive=!1,e._reconnect_timer=null,e._heart_timer=null,e._heartbeat_check_timer=null,n.hasOwnProperty("heartbeat")?e._heartbeat=n.heartbeat:e._heartbeat=1e3,n.hasOwnProperty("onOpen")&&(e._onOpenCallback=n.onOpen),n.hasOwnProperty("onClose")&&(e._onCloseCallback=n.onClose),n.hasOwnProperty("onError")&&(e._onErrorCallback=n.onError),n.hasOwnProperty("onHeartBeat")&&(e._onHeartBeatCallback=n.onHeartBeat),n.hasOwnProperty("onMessage")&&(e._onMessageCallback=n.onMessage),e._reconnect=!0,e._reconnectTime=3e3,e._reconnectTimes=0,e._reconnectMaxTimes=20,e.init(),_possibleConstructorReturn(e)}return _createClass(r,[{key:"clearHeartBeatTimer",value:function(){this._heart_timer&&(clearInterval(this._heart_timer),this._heart_timer=null),this._heartbeat_check_timer&&(clearTimeout(this._heartbeat_check_timer),this._heartbeat_check_timer=null)}},{key:"clear",value:function(){this._reconnect_timer&&(clearInterval(this._reconnect_timer),this._reconnect_timer=null),this.clearHeartBeatTimer(),this._ws&&(this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null),this._ws=null}},{key:"init",value:function(){var e=this,t=this._wsUrl;try{this._ws&&this.clear(),this._ws=new WebSocket(t)}catch(t){console.error(t),this.clear(),this.emitEvent(V)}this._ws.onopen=function(t){e._alive=!0;var r=j;e._reconnect_timer&&(clearInterval(e._reconnect_timer),e._reconnect_timer=null,e._reconnectTimes=0,r=N),e.clearHeartBeatTimer(),"function"==typeof e._onOpenCallback&&e._onOpenCallback(t),e._startHeartBeat(),e.emitEvent(r)},this._ws.onclose=function(t){console.log("close event",t),e._alive=!1,e.clearHeartBeatTimer(),e._ws&&e._ws.close(),e._reconnect&&e.onReconnect(),"function"==typeof e._onCloseCallback&&e._onCloseCallback(t)},this._ws.onerror=function(t){console.error("websocket error:",t),"function"==typeof e._onErrorCallback&&e._onErrorCallback(t)},this._ws.onmessage=function(t){var r=t.data;e._onMessage(r)}}},{key:"_startHeartBeat",value:function(){var e=this;this._alive&&"function"==typeof this._onHeartBeatCallback&&(this._onHeartBeatCallback(),this._heartbeat_check_timer&&(clearTimeout(this._heartbeat_check_timer),this._heartbeat_check_timer=null),this._heartbeat_check_timer=_setTimeout((function(){e.emitEvent(V),e._ws&&e._ws.close(),e._heartbeat_check_timer=null}),1e4))}},{key:"_onMessage",value:function(e){var t=this,r=new FileReader;r.readAsArrayBuffer(e),r.onload=function(e){var n,o=new Uint8Array(r.result),i=z.Output.decode(o);console.debug(_concatInstanceProperty(n="Receive websocket message ".concat(X.get(i.Type),": ")).call(n,i.Type)),i.Type===z.PackageType.PT_HEARTBEAT?t._heart_timer=_setTimeout((function(){t._startHeartBeat()}),t._heartbeat):"function"==typeof t._onMessageCallback&&t._onMessageCallback(i)}}},{key:"onReconnect",value:function(e){var t=this;this.emitEvent(L),this._reconnect_timer||(this._reconnect_timer=_setInterval((function(){if(t._reconnectTimes>=t._reconnectMaxTimes)return clearInterval(t._reconnect_timer),t._reconnect_timer=null,t._reconnectTimes=0,void t.emitEvent(D);t._reconnectTimes++,t.init(),e&&e(t)}),this._reconnectTime))}},{key:"send",value:function(e){this._alive&&this._ws.send(e)}},{key:"close",value:function(){this._reconnect=!1,this._reconnect_timer&&(clearInterval(this._reconnect_timer),this._reconnect_timer=null),this.clearHeartBeatTimer(),this._alive&&this._ws&&(this._ws.close(),this._ws=null),this._alive=!1}},{key:"onmessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._ws.onmessage=function(n){t._message_func=e,e(r?n:n.data)}}},{key:"onopen",value:function(e){this._onOpenCallback=e}},{key:"onclose",value:function(e){this._onCloseCallback=e}},{key:"onerror",value:function(e){this._onErrorCallback=e}}]),r}(s.default),ee="room_start",te="room_stop",re="user_status",ne="room_attr",oe="user_attr",ie="kickout_of_room",se="join",ae="leave",ce=0,ue=1,le=2,de=3,_e=4,he=Y.pb,pe=new _Map(_mapInstanceProperty(o=_Object$keys(he.PackageType)).call(o,(function(e){return[he.PackageType[e],e]}))),fe=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this))._isInit=!1,e._wsUrl="",e._token="",e._userId=0,e._socket=null,e._connectState=null,e._connectFailCount=0,e._stopped=!0,e._protocol=null,e._system=null,e}return _createClass(r,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._isInit){if(e.hasOwnProperty("websocketURI")&&(this._host=e.websocketURI),!e.hasOwnProperty("token"))throw K.LVP_SERVER_TOKEN_IS_NULL;if(this._token=e.token,!e.hasOwnProperty("appKey"))throw K.LVP_SERVER_APP_KEY_IS_NONE;if(this._appKey=e.appKey,!e.hasOwnProperty("userId"))throw K.LVP_SERVER_USER_ID_IS_NONE;this._userId=e.userId,e.hasOwnProperty("system")&&(this._system=e.system),this._isInit=!0}}},{key:"login",value:function(){var e=this;return new _Promise((function(t,r){if(!e._stopped)return console.error("lvp service already be started"),r();e._stopped=!1,e._connect();var n=_setInterval((function(){switch(e._connectState){case le:return clearInterval(n),t();case de:case _e:case ce:return r()}}),50)}))}},{key:"join",value:function(e){if(!e)throw Error("Miss lvp room id");this._inputMessage(he.PackageType.PT_JOIN_ROOM,{RoomId:e})}},{key:"leave",value:function(e){if(!e)throw Error("Miss lvp room id");this._inputMessage(he.PackageType.PT_LEAVE_ROOM,{RoomId:e})}},{key:"logout",value:function(){this._stopped||(this._stopped=!0,this._socket&&(this._socket.close(),this._socket=null))}},{key:"_send",value:function(e){if(!this._socket)throw Error("socket is null");this._socket.send(e)}},{key:"_inputMessage",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r=n=_JSON$stringify(n);var o={Type:e};(t=(new window.TextEncoder).encode(r))&&(o.Data=_Array$from(t));var i=he.Input.encode(he.Input.create(o)).finish();e===he.PackageType.PT_HEARTBEAT||e===he.PackageType.PT_MONITOR_DATA?console.debug("Send websocket message ".concat(pe.get(e))):console.debug("Send websocket message ".concat(pe.get(e),":"),n),this._send(i)}},{key:"_sendMessage",value:function(e,t,r){var n,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(e===x.Room?n=he.ReceiverType.RT_ROOM:e===x.Peer&&(n=he.ReceiverType.RT_USER),o=o||t.toString(),!n)throw Error("message type error:".concat(n));var i={ReceiverType:n,ReceiverId:t,Category:o,MessageContent:r};this._inputMessage(he.PackageType.PT_MESSAGE,i)}},{key:"sendMessageToRoom",value:function(e,t,r){this._sendMessage(x.Room,e,r,t)}},{key:"sendMessageToPeer",value:function(e,t){this._sendMessage(x.Peer,e,t)}},{key:"sendMonitorData",value:function(e){var t={Data:e="object"==_typeof(e)?_JSON$stringify(e):e.toString()};this._inputMessage(he.PackageType.PT_MONITOR_DATA,t)}},{key:"syncRoomAttr",value:function(e){this._inputMessage(he.PackageType.PT_SYNC_ROOM_ATTR,{RoomId:e})}},{key:"syncUsersAttr",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r={RoomId:e};t&&(r.Keys=t),this._inputMessage(he.PackageType.PT_SYNC_USER_ATTR,r)}},{key:"_handleMessage",value:function(e){var t=JSON.parse(e);if(console.log("handleMessage::Receive Data:",t),"system"===t.MsgType)switch(t.Category){case ee:this.trigger(m,[_parseInt(t.RoomId),_parseInt(t.SenderId)]);break;case te:this.trigger(v,[_parseInt(t.RoomId),_parseInt(t.SenderId)]);break;case re:var r;t.Status===ae?r=I:t.Status===se&&(r=b),r&&this.trigger(r,[_parseInt(t.RoomId),_parseInt(t.UserId)]);break;case ne:this.trigger(R,[{roomId:_parseInt(t.RoomId),senderId:_parseInt(t.SenderId),attrs:t.Attrs}]);break;case oe:var n="init"===t.Status?E:O;this.trigger(n,[{roomId:_parseInt(t.RoomId),senderId:_parseInt(t.SenderId),targetId:_parseInt(t.UserId),attrs:t.Attrs}]);break;case ie:this.trigger(M,[Number(t.RoomId),Number(t.SenderId),Number(t.UserId)])}else if("custom"===t.MsgType){var o=1===Number(t.RecvType)?y:g;this.trigger(o,[t.Category,Number(t.SenderId),Number(t.RecvId),t.Message])}}},{key:"_handlePackage",value:function(e){var t,r=this;if(e.Data){var n,o=(n=e.Data,new window.TextDecoder("utf-8").decode(n)),i=JSON.parse(o);switch(console.log("handlePackage::Receive Data:",i),e.Type){case he.PackageType.PT_REMOTE_LOGIN:var s=i.hasOwnProperty("System")?i.System:null;this.trigger(U,[s]);break;case he.PackageType.PT_MESSAGE:i&&_Array$isArray(i.Messages)&&_mapInstanceProperty(t=i.Messages).call(t,(function(e){r._handleMessage(e)}));break;case he.PackageType.PT_SYNC_ROOM_ATTR:this.trigger(T,[i.RoomId,i.Attrs?JSON.parse(i.Attrs):{}]);break;case he.PackageType.PT_SYNC_USER_ATTR:this.trigger(k,[i.RoomId,i.AttrsList?i.AttrsList:[],!!i.hasOwnProperty("hasMore")&&i.HasMore]);break;case he.PackageType.PT_JOIN_ROOM:var a,c=[i.RoomId];0===e.Code?a=p:(a=f,c.push(e.ErrMessage)),this.trigger(a,c)}}}},{key:"_connect",value:function(){var e,t,r,n,o=this;this._stopped?console.error("im service stopped"):null===this._socket?(this._connectState=ue,this._wsUrl=_concatInstanceProperty(e=_concatInstanceProperty(t=_concatInstanceProperty(r="".concat(this._host,"/ws/lvb?app_key=")).call(r,this._appKey,"&user_id=")).call(t,this._userId,"&token=")).call(e,this._token),this._system&&(this._wsUrl=_concatInstanceProperty(n="".concat(this._wsUrl,"&system=")).call(n,this._system)),console.log("Connect websocket ",this._wsUrl),this._socket=new Z({wsUrl:this._wsUrl,onOpen:function(e){o._onOpen()},onError:function(e){o._onError()},onClose:function(e){o._onClose()},onHeartBeat:function(){o._onHeartbeat()},onMessage:function(e){o._handlePackage(e)}}),this._socket.on(j,(function(){o.emitEvent(w)})),this._socket.on(N,(function(){o.emitEvent(A)})),this._socket.on(L,(function(){o.emitEvent(P)})),this._socket.on(D,(function(){o.emitEvent(C)}))):console.error("socket isn't null")}},{key:"_onError",value:function(){this._connectFailCount++,this._connectState=de,this.trigger(s.default.CONN_STATE_CONNECTFAILURE,[this._connectState])}},{key:"_onOpen",value:function(){this._connectState=le}},{key:"_onClose",value:function(){this._connectState=ce}},{key:"_onHeartbeat",value:function(){this._inputMessage(he.PackageType.PT_HEARTBEAT)}}]),r}(s.default),ye=function(e){_inherits(r,e);var t=_createSuper(r);function r(){var e;return _classCallCheck(this,r),(e=t.call(this))._lvp=null,e._userId=null,e._roomInfo={},e._isInit=!1,e._eventTrigger=null,e._roomId=null,e._customCategory=[],e}return _createClass(r,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._isInit){var t,r,n={};e.hasOwnProperty("innerUserId")&&(this._userId=e.innerUserId),e.hasOwnProperty("userId")&&(n.userId=e.userId),e.hasOwnProperty("websocketURI")?n.websocketURI=e.websocketURI:n.websocketURI="wss://open.jjldxz.com",e.hasOwnProperty("apiBaseURL")?H(e.apiBaseURL):H("https://open.jjldxz.com/api"),e.hasOwnProperty("token")&&((t=e.token)&&(J.defaults.headers.token="".concat(t)),n.token=e.token),e.hasOwnProperty("appKey")&&((r=e.appKey)&&(J.defaults.headers["app-key"]=r),n.appKey=e.appKey),e.hasOwnProperty("system")&&(n.system=e.system),e.hasOwnProperty("eventTrigger")&&e.eventTrigger instanceof s.default?this._eventTrigger=e.eventTrigger:this._eventTrigger=this,e.hasOwnProperty("roomId")&&(this._roomId=e.roomId),this._lvp=new fe,this._lvp.init(n),this._isInit=!0}}},{key:"login",value:function(){var e=_asyncToGenerator(_regeneratorRuntime.mark((function e(){return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._isInit){e.next=2;break}throw Error("RTMEngine:login - need init first");case 2:return this._bindLvpEvents(),e.next=5,this._lvp.login();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"logout",value:function(){if(!this._isInit)throw Error("RTMEngine:logout - need init first");this._lvp.logout()}},{key:"join",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._isInit)throw Error("RTMEngine:join - need init first");if(!e&&(e=this._roomId),!e)throw Error("RTMEngine:join - miss room id");this._lvp&&this._lvp.join(e)}},{key:"leave",value:function(e){if(!this._isInit)throw Error("RTMEngine:leave - need init first");if(!e)throw Error("RTMEngine:leave - miss room id");this._lvp&&this._lvp.leave(e)}},{key:"sendMessageToRoomFromWS",value:function(e,t,r){if(!this._isInit)throw Error("RTMEngine:leave - need init first");if(!e)throw Error("RTMEngine:leave - miss room id");r="object"==_typeof(r)?_JSON$stringify(r):r.toString(),this._lvp.sendMessageToRoom(e,t,r)}},{key:"sendMessageToPeerFromWS",value:function(e,t){if(!this._isInit)throw Error("RTMEngine:leave - need init first");t="object"==_typeof(t)?_JSON$stringify(t):t.toString(),this._lvp.sendMessageToPeer(e,t)}},{key:"sendMonitorData",value:function(e){if(!this._isInit)throw Error("RTMEngine:leave - need init first");this._lvp.sendMonitorData(e)}},{key:"sendMessageToRoom",value:function(e,t,r){return function(e,t,r){return J.post("/client/send_room_msg",{room_id:e,category:t,message:r})}(e,t,r="object"==_typeof(r)?_JSON$stringify(r):r.toString())}},{key:"sendMessageToPeer",value:function(e,t,r){return function(e,t,r){return J.post("/client/send_user_msg",{user_id:e,category:t,message:r})}(e,t,r="object"==_typeof(r)?_JSON$stringify(r):r.toString())}},{key:"setRoomAttr",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!this._isInit)throw Error("RTMEngine:leave - need init first");if(!e)throw Error("RTMEngine:leave - miss room id");var n={};return n[String(t)]=JSON.parse(_JSON$stringify(r)),$(e,n)}},{key:"setRoomAttrs",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._isInit)throw Error("RTMEngine:leave - need init first");if(!e)throw Error("RTMEngine:leave - miss room id");return $(e,t)}},{key:"setUserInitAttrs",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._isInit)throw Error("RTMEngine:setUserAttr - need init first");if(!e)throw Error("RTMEngine:setUserAttr - miss room id");if(!t)throw Error("RTMEngine:setUserAttr - miss user id");return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J.post("/client/set_user_init_attrs",{room_id:e,user_id:t,attrs:r})}(e,t,r)}},{key:"setUserAttrs",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._isInit)throw Error("RTMEngine:setUserAttr - need init first");if(!e)throw Error("RTMEngine:setUserAttr - miss room id");if(!t)throw Error("RTMEngine:setUserAttr - miss user id");return function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return J.post("/client/set_user_attrs",{room_id:e,user_id:t,attrs:r})}(e,t,r)}},{key:"requestSyncRoomAttrs",value:function(e){if(!this._isInit)throw Error("RTMEngine:requestSyncRoomAttrs - need init first");if(!e)throw Error("RTMEngine:requestSyncRoomAttrs - miss room id");this._lvp&&this._lvp.syncRoomAttr(e)}},{key:"requestSyncUsersAttrs",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!this._isInit)throw Error("RTMEngine:requestSyncUsersAttrs - need init first");if(!e)throw Error("RTMEngine:requestSyncUsersAttrs - miss room id");t=t?[t]:null,this._lvp&&this._lvp.syncUsersAttr(e,t)}},{key:"requestSyncUsersAttrsByRoles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!this._isInit)throw Error("RTMEngine:requestSyncUsersAttrsByRoles - need init first");if(!e)throw Error("RTMEngine:requestSyncUsersAttrsByRoles - miss room id");this._lvp&&this._lvp.syncUsersAttr(e,[{Key:"role",Values:t}])}},{key:"kickOut",value:function(e,t){if(!this._isInit)throw Error("RTMEngine:kickOut - need init first");if(!e)throw Error("RTMEngine:kickOut - miss room id");return r=e,n=t,J.post("/client/kick",{room_id:r,user_id:n});var r,n}},{key:"registerRTMCategory",value:function(e){var t;return-1!==_findIndexInstanceProperty(t=this._customCategory).call(t,(function(t){return t===e}))&&this._customCategory.push(e),this.getCustomEventByCategory(e)}},{key:"getCustomEventByCategory",value:function(e){var t=h[e];return!t&&(t="rtm-".concat(e,"-message")),t}},{key:"unregisterRTMCategory",value:function(e){var t,r,n=_findIndexInstanceProperty(t=this._customCategory).call(t,(function(t){return t===e}));-1===n&&_spliceInstanceProperty(r=this._customCategory).call(r,n,1)}},{key:"stopRoom",value:function(e){return t=e,J.post("/client/stop_room",{room_id:t});var t}},{key:"_bindLvpEvents",value:function(){var e=this;if(!this._isInit)throw Error("RTMEngine:_bindLvpEvents - need init first");this._lvp.on(p,(function(t){e._eventTrigger.trigger(d.LOCAL_USER_JOIN_SUCCESS,[t])})),this._lvp.on(f,(function(t){e._eventTrigger.trigger(d.LOCAL_USER_JOIN_FAIL,[t])})),this._lvp.on(m,(function(t,r){e._userId!==r&&e._eventTrigger.trigger(d.ROOM_START,[t,r])})),this._lvp.on(v,(function(t,r){e._userId!==r&&e._eventTrigger.trigger(d.ROOM_STOP,[t,r])})),this._lvp.on(b,(function(t,r){e._userId!==r&&e._onJoinRoom(t,r)})),this._lvp.on(I,(function(t,r){e._userId!==r&&e._onLeaveRoom(t,r)})),this._lvp.on(T,(function(t,r){e._onSyncRoomAttrs(t,r)})),this._lvp.on(k,(function(t,r,n){e._onSyncUserAttrs(t,r,n)})),this._lvp.on(g,(function(t,r,n,o){e._userId!==r&&e._parseRCustomMessage(t,r,n,o,x.Room)})),this._lvp.on(y,(function(t,r,n,o){e._parseRCustomMessage(t,r,n,o,x.Peer)})),this._lvp.on(R,(function(t){e._onRoomAttrsUpdate(t)})),this._lvp.on(O,(function(t){e._onUserAttrsUpdate(t)})),this._lvp.on(E,(function(t){e._onUserAttrsUpdate(t,!0)})),this._lvp.on(w,(function(t){e._eventTrigger.emitEvent(d.CONNECTED)})),this._lvp.on(A,(function(t){e._eventTrigger.emitEvent(d.RECONNECTED)})),this._lvp.on(P,(function(t){e._eventTrigger.emitEvent(d.RECONNECTING)})),this._lvp.on(C,(function(t){e._eventTrigger.emitEvent(d.RECONNECT_MAX_TIME)})),this._lvp.on(M,(function(t,r,n){e._userId!==r&&e._eventTrigger.trigger(d.KICK_OUT,[t,r,n])})),this._lvp.on(U,(function(t){e._eventTrigger.trigger(d.REMOTE_LOGIN,[t])}))}},{key:"_parseRCustomMessage",value:function(e,t,r,n,o){var i,s,a,c=[t,r,n,o];switch(e){case _.Chat:a=d.CHAT_MESSAGE;break;case _.Control:a=d.CONTROL_MESSAGE;break;case _.Whiteboard:a=d.WHITEBOARD_MESSAGE;break;default:_includesInstanceProperty(i=this._customCategory).call(i,e)?a=this.getCustomEventByCategory(e):(a=d.CUSTOM_MESSAGE,c=_concatInstanceProperty(s=[e]).call(s,_toConsumableArray(c)))}this._eventTrigger.trigger(a,c)}},{key:"_parseRoomAttr",value:function(e){var t,r=this;_mapInstanceProperty(t=_Object$keys(e)).call(t,(function(t){r._roomInfo[t]=e[t]}))}},{key:"_onSyncRoomAttrs",value:function(e,t){this._parseRoomAttr(t),this._eventTrigger.trigger(d.SYNC_ROOM_ATTR,[e,this._roomInfo])}},{key:"_onJoinRoom",value:function(e,t){t!==this._userId&&this._eventTrigger.trigger(d.MEMBER_ONLINE,[e,t])}},{key:"_onLeaveRoom",value:function(e,t){t!==this._userId&&this._eventTrigger.trigger(d.MEMBER_OFFLINE,[e,t])}},{key:"_onSyncUserAttrs",value:function(e,t,r){t=_mapInstanceProperty(t).call(t,(function(e){return _objectSpread({id:Number(e.UserId)},JSON.parse(e.Attrs))})),this._eventTrigger.trigger(d.SYNC_USER_ATTR,[e,t,r])}},{key:"_parseUpdateUserAttrs",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4]?d.USER_ATTR_INIT:d.USER_ATTR_UPDATE;this._eventTrigger.trigger(o,[e,t,r,n])}},{key:"_onUserAttrsUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.roomId,n=e.senderId,o=e.targetId,i=e.attrs;this._parseUpdateUserAttrs(r,o,i,n,t)}},{key:"_onRoomAttrsUpdate",value:function(e){var t,r=this,n=e.roomId,o=e.senderId,i=e.attrs;_mapInstanceProperty(t=_Object$keys(i)).call(t,(function(e){r._roomInfo[e]=i[e]})),this._eventTrigger.trigger(d.ROOM_ATTR_UPDATE,[n,i,o])}},{key:"on",value:function(e,t){this._eventTrigger.on(e,(function(){t.apply(void 0,arguments)}))}},{key:"trigger",value:function(e,t){return this._eventTrigger.trigger(e,t)}},{key:"emit",value:function(e){for(var t,r,n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];return(t=this._eventTrigger).emit.apply(t,_concatInstanceProperty(r=[e]).call(r,o))}},{key:"emitEvent",value:function(e,t){return this._eventTrigger.emitEvent(e,t)}}]),r}(s.default);return ye.RTMEvents=d,ye.MessageCategory=_,ye.MessageType=x,ye}(i.default,a.default,c.default)}(t={exports:{}}),t.exports}(),E=a.default.create({baseURL:"",timeout:5e3});function T(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return E.post("/client/join_room",{room_id:e,user_id:t,admin:r})}E.defaults.validateStatus=function(e){return/^(2|3)\d{2}$/.test(e)},E.defaults.headers["Content-Type"]="application/json;charset=UTF-8",E.defaults.responseType="json",E.defaults.baseURL="https://open.jjldxz.com/api",E.interceptors.response.use((function(e){return e.data}),(function(e){return _Promise.reject(e)}));var k=function(e){_inherits(n,e);var t,r=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=r.call(this))._roomId=null,e._userId=null,e._init=!1,e._roomOpts={},e._joined=!1,e._rtm=null,e._token=null,e._appKey=null,e._apiBaseURL=null,e._shareId=null,e._shareOpts=null,e._share=null,e}return _createClass(n,[{key:"userId",get:function(){return this._roomOpts.int_user_id}},{key:"roomId",get:function(){return this._roomOpts.int_room_id}},{key:"screenShareId",get:function(){return this._shareOpts?this._shareOpts.int_user_id:null}},{key:"screenShareOpts",get:function(){return this._share}},{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._init){if(!_(e,"token"))throw Error("LvbEngine:init - Miss auth token");var t,r;if((t=e.token)&&(E.defaults.headers.token=t),this._token=e.token,!_(e,"appKey"))throw Error("lvbEngine:init - Miss app key");if((r=e.appKey)&&(E.defaults.headers["app-key"]=r),this._appKey=e.appKey,!_(e,"roomId"))throw Error("lvbEngine:init - Miss room id");if(this._roomId=e.roomId,!_(e,"userId"))throw Error("lvbEngine:init - Miss user id");this._userId=e.userId,_(e,"share")&&(this._share=e.share),this._init=!0}}},{key:"join",value:function(){var e=this;return new _Promise((function(t,r){if(!e._init)throw r("LvbEngine:join - please call LvbEngine.init at first");if(e._joined)return t();var n,o,i;e._share?_Promise.all([T(e._roomId,e._userId),(n=e._roomId,o=e._share.id,i=e._share.token,E.post("/client/join_room",{room_id:n,user_id:o,admin:!1},{headers:{token:i}}))]).then((function(r){e._roomOpts=r[0],e._shareOpts=r[1],e._joined=!0,t()})).catch(r):T(e._roomId,e._userId).then((function(r){e._roomOpts=r,e._shareOpts=null,e._joined=!0,t()})).catch(r)}))}},{key:"createRTC",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this._joined)throw Error("LvbEngine:createRTC - please call LvbEngine.init at first");var t=b(this._roomOpts.rtc_provider),r={appId:this._roomOpts.rtc_app_id,token:this._roomOpts.rtc_token,roomId:this._roomOpts.int_room_id,userId:this._roomOpts.int_user_id,screenShare:{userId:"",token:""},eventTrigger:this};return _(e,"videoQuality")&&(r.videoQuality=e.videoQuality),_(e,"rendererMode")&&(r.rendererMode=e.rendererMode),_(e,"rtcProfile")&&(r.rtcProfile=e.rtcProfile),_(e,"isHost")&&(r.isHost=e.isHost),_(e,"autoSubscribe")&&(r.autoSubscribe=e.autoSubscribe),this._shareOpts&&(r.screenShare={id:this._shareOpts.int_user_id,token:this._shareOpts.rtc_token}),t.init(r),t}},{key:"createRTCForTest",value:function(){return b("agora").createTestRTC("23fd67cf83b44203ba114e48ec669b96")}},{key:"createRTM",value:(t=_asyncToGenerator(_regeneratorRuntime.mark((function e(){var t,r,n=arguments;return _regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.length>0&&void 0!==n[0]?n[0]:{},this._joined){e.next=3;break}throw Error("LvbEngine:createRTM - please call LvbEngine.init at first");case 3:return this._rtm=new O,r={userId:this._userId,innerUserId:this._roomOpts.int_user_id,token:this._token,appKey:this._appKey,roomId:this._roomOpts.int_room_id,eventTrigger:this},_(t,"system")&&(r.system=t.system),this._rtm.init(r),e.next=9,this._rtm.login();case 9:return this._rtm.join(),e.abrupt("return",this._rtm);case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),n}(i.default);return k.RTMEvents=O.RTMEvents,k.RTMMessageCategory=O.MessageCategory,k.RTMMessageType=O.MessageType,k.RTCEvents=R,k.RTCTestEvents=I,k.RTMCustomMessageType=O.MessageType,k.RTMDefaultCategory=O.MessageCategory,k.RTCProfile=m.RtcProfile,k.VituralBackgroundType=m.VituralBackgroundType,k.VideoQuality=d,k}));
